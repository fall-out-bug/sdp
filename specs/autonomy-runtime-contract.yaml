version: v1
name: AutonomousRuntimeModule

operations:
  - claimTask
  - loadTask
  - createBranch
  - executeTask
  - runVerification
  - buildEvidence
  - publishPR
  - updateTaskState
  - escalate

state_machine:
  canonical:
    - open
    - in_progress
    - review
    - verified
    - done
  side_states:
    - blocked
    - escalated
    - cancelled

evidence:
  required_sections:
    - intent
    - plan
    - execution
    - verification
    - review
    - risk_notes
    - boundary
    - provenance
    - trace

boundary_contract:
  required:
    - declared
    - observed
    - compliance
  declared_fields:
    - allowed_path_prefixes
    - control_path_prefixes
    - forbidden_path_prefixes
    - role
    - lane
  observed_fields:
    - touched_paths
    - out_of_boundary_paths
  compliance_fields:
    - ok
    - reason

provenance:
  required:
    - run_id
    - orchestrator
    - runtime
    - model
    - gate_results
    - phase
    - role
    - captured_at
    - source_issue_id
    - artifact_id
    - contract_version
    - hash_algorithm
    - sequence
    - payload_digest
    - hash
    - hash_prev

hash_chain_contract:
  version: artifact-provenance/v1
  hash_algorithm: sha256
  deterministic_schema_fields:
    - contract_version
    - hash_algorithm
    - issue_id
    - artifact_id
    - artifact_class
    - phase
    - role
    - captured_at
    - sequence
    - hash_prev
    - payload_digest
    - hash
  append_only_rules:
    - genesis requires sequence=0 and empty hash_prev
    - non-genesis requires hash_prev to equal previous hash
    - sequence increments by one per issue stream

artifact_bus:
  intake_doc: docs/ARTIFACT_PROVENANCE_INTAKE.md
  contract_doc: docs/ARTIFACT_PROVENANCE_HASH_CHAIN_CONTRACT.md
  classes:
    - id: intent-brief
      retention_days: 365
    - id: execution-plan
      retention_days: 365
    - id: code-diff
      retention_days: 1095
    - id: verification-report
      retention_days: 1095
    - id: review-verdict
      retention_days: 1095
    - id: trace-link
      retention_days: 1825
  append_only_store:
    partition_key: source_issue_id
    ordering_key: sequence
    immutable_fields:
      - hash
      - hash_prev
      - payload_digest
    constraints:
      - reject updates to existing (source_issue_id, sequence)
      - require deterministic hash validation before append

model_policy:
  allowlist:
    - glm-5
    - glm-4.7
  fallback_chain:
    - glm-5
    - glm-4.7
    - escalated
