{
  "version": "v1",
  "artifact": "kubeopencode-sdp-internal-hardening-patches",
  "issue_id": "sdp_dev-2aq.7.4",
  "upstream_base": "kubeopencode Task/Agent CRDs",
  "patches": [
    {
      "id": "IH-001",
      "name": "private-model-allowlist-gate",
      "category": "policy",
      "non_upstream_rationale": "Depends on private model policy bundles and tenancy-specific allowlists.",
      "isolation_boundary": {
        "layer": "adapter-policy-gate",
        "touches_upstream_core": false,
        "requires_crd_change": false,
        "feature_flag": "SDP_POLICY_ENFORCEMENT_ENABLED"
      },
      "compatibility_assumptions": [
        "Task and Agent CRD schemas remain unchanged.",
        "Deny outcomes are represented through existing status/notes pathways."
      ]
    },
    {
      "id": "IH-002",
      "name": "risk-threshold-terminal-guard",
      "category": "policy",
      "non_upstream_rationale": "Uses private SDP risk classes and internal escalation policies.",
      "isolation_boundary": {
        "layer": "adapter-terminal-transition-interceptor",
        "touches_upstream_core": false,
        "requires_crd_change": false,
        "feature_flag": "SDP_POLICY_ENFORCEMENT_ENABLED"
      },
      "compatibility_assumptions": [
        "Upstream Task terminal phases are consumed without mutation.",
        "Blocked outcomes map to SDP lifecycle, not upstream API extension."
      ]
    },
    {
      "id": "IH-003",
      "name": "tenant-boundary-egress-guard",
      "category": "security",
      "non_upstream_rationale": "Enforces SDP-internal tenant namespace and egress boundaries.",
      "isolation_boundary": {
        "layer": "internal-tenancy-guard",
        "touches_upstream_core": false,
        "requires_crd_change": false,
        "feature_flag": "SDP_TENANCY_GUARD_ENABLED"
      },
      "compatibility_assumptions": [
        "No upstream API fields are added.",
        "Runtime guardrails are isolated to deployment-specific configuration."
      ]
    },
    {
      "id": "IH-004",
      "name": "evidence-redaction-guard",
      "category": "compliance",
      "non_upstream_rationale": "Implements private identifier and topology redaction not suitable for generic upstream defaults.",
      "isolation_boundary": {
        "layer": "adapter-evidence-projector-redaction",
        "touches_upstream_core": false,
        "requires_crd_change": false,
        "feature_flag": "SDP_EVIDENCE_REDACTION_ENABLED"
      },
      "compatibility_assumptions": [
        "Evidence section keys remain contract-stable.",
        "Only sensitive value payloads are transformed."
      ]
    }
  ],
  "validation": [
    {
      "id": "VAL-IH-001",
      "scenario": "Dispatch request uses disallowed model.",
      "expected_hardening_behavior": "Execution denied with policy_denied reason and traceable note.",
      "upstream_compatibility_check": "Task/Agent manifests remain schema-compatible.",
      "result": "pass"
    },
    {
      "id": "VAL-IH-002",
      "scenario": "Task succeeds but exceeds private risk threshold.",
      "expected_hardening_behavior": "Terminal close is blocked with deterministic remediation output.",
      "upstream_compatibility_check": "Succeeded phase remains readable without custom status fields.",
      "result": "pass"
    },
    {
      "id": "VAL-IH-003",
      "scenario": "Evidence payload contains private host and token markers.",
      "expected_hardening_behavior": "Sensitive markers redacted before persistence and publish.",
      "upstream_compatibility_check": "Evidence contract keys unchanged.",
      "result": "pass"
    },
    {
      "id": "VAL-IH-004",
      "scenario": "All hardening feature flags disabled.",
      "expected_hardening_behavior": "Adapter follows baseline path with no private controls enforced.",
      "upstream_compatibility_check": "Behavior aligns with kubeopencode-compatible defaults.",
      "result": "pass"
    }
  ]
}
