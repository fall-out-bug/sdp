{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://sdp.dev/specs/runtime/schemas/kubeopencode-sdp-adapter-contract.schema.json",
  "title": "KubeOpenCode SDP Adapter Contract",
  "type": "object",
  "required": [
    "version",
    "artifact",
    "issue_id",
    "crd_mapping",
    "boundary_contracts",
    "integration_scenarios",
    "migration"
  ],
  "properties": {
    "version": {
      "type": "string",
      "minLength": 1
    },
    "artifact": {
      "const": "kubeopencode-sdp-adapter-contract"
    },
    "issue_id": {
      "type": "string",
      "pattern": "^sdp_dev-[a-z0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "references": {
      "type": "object"
    },
    "crd_mapping": {
      "type": "object",
      "required": [
        "task",
        "agent"
      ],
      "properties": {
        "task": {
          "$ref": "#/$defs/mappingArray"
        },
        "agent": {
          "$ref": "#/$defs/mappingArray"
        }
      }
    },
    "boundary_contracts": {
      "type": "object",
      "required": [
        "beads",
        "fsm",
        "evidence",
        "policy"
      ],
      "properties": {
        "beads": {
          "type": "object"
        },
        "fsm": {
          "type": "object"
        },
        "evidence": {
          "type": "object"
        },
        "policy": {
          "type": "object"
        }
      }
    },
    "integration_scenarios": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "id",
          "name",
          "expected_terminal_state"
        ],
        "properties": {
          "id": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "expected_terminal_state": {
            "type": "string"
          }
        }
      }
    },
    "migration": {
      "type": "object",
      "required": [
        "phases",
        "rollback_steps"
      ],
      "properties": {
        "phases": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "rollback_steps": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    }
  },
  "$defs": {
    "mappingItem": {
      "type": "object",
      "required": [
        "source",
        "target",
        "rule",
        "deterministic"
      ],
      "properties": {
        "source": {
          "type": "string"
        },
        "target": {
          "type": "string"
        },
        "rule": {
          "type": "string"
        },
        "deterministic": {
          "type": "boolean"
        }
      }
    },
    "mappingArray": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/mappingItem"
      }
    }
  }
}
