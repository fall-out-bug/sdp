# WS: Safe Config Migrations

**Feature**: F075 - Self-Healing Doctor
**ID**: 00-075-04
**Priority**: P0
**Depends on**: 00-075-01

## Goal
Add automatic config migration with backup/rollback support for version upgrades.

## Scope Files
- `sdp-plugin/cmd/sdp/doctor.go`
- `sdp-plugin/internal/doctor/doctor_migrate.go` (NEW)
- `sdp-plugin/internal/config/migrate.go` (NEW)

## Acceptance Criteria
1. Detects outdated `.sdp/config.yml` version
2. Creates timestamped backup before migration
3. Migrates config to latest version preserving all settings
4. Validates migrated config
5. Supports `--rollback` to restore from backup
6. Logs migration history to `.sdp/migrations.log`
7. Tests for migrations (>= 80% coverage)

## Out of Scope
- Repair mode (00-075-01)
- Deep checks (00-075-02)

## Implementation Notes
```go
type Migration struct {
    FromVersion int
    ToVersion   int
    BackupPath  string
    Timestamp   time.Time
}

func MigrateConfig(dryRun bool) (*Migration, error) {
    // Backup -> Migrate -> Validate
}

func RollbackMigration(backupPath string) error {
    // Restore from backup
}
```

## Test Strategy
- Unit tests for each migration version
- Test backup/rollback roundtrip
- Test with corrupted config (graceful error)
