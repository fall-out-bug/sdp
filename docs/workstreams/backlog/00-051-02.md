---
ws_id: 00-051-02
feature_id: F051
title: "Search Engine: Hybrid Search"
status: backlog
priority: 0
depends_on: [00-051-01]
blocks: []
project_id: sdp
beads_id: sdp-6fx.11
---

## Goal

Implement hybrid search combining full-text, semantic, and graph-based retrieval.

## Context

Part of F051 Long-term Memory System. Builds on the artifact indexer (00-051-01) to provide multiple search modalities.

**Related Beads:** sdp-6fx.11 (Drift detection system)

## Acceptance Criteria

- [ ] AC1: Full-text search via SQLite FTS5 with <50ms response
- [ ] AC2: Semantic search using embeddings API with caching
- [ ] AC3: Graph traversal for related artifacts (by feature_id, ws_id)
- [ ] AC4: Combined ranking: FTS score + semantic similarity + graph distance
- [ ] AC5: Query response time <500ms for 1000+ artifacts

## Scope Files

```yaml
scope_files:
  - sdp-plugin/internal/memory/search.go        # NEW
  - sdp-plugin/internal/memory/search_test.go   # NEW
  - sdp-plugin/internal/memory/embeddings.go    # NEW
  - sdp-plugin/internal/memory/embeddings_test.go # NEW
  - sdp-plugin/internal/memory/graph.go         # NEW
  - sdp-plugin/cmd/sdp/search.go                # NEW
```

## Implementation Notes

### Search Interface

```go
type Searcher interface {
    Search(ctx context.Context, query string, opts SearchOptions) (*SearchResult, error)
}

type SearchOptions struct {
    Mode       SearchMode // FTS, Semantic, Hybrid
    Limit      int
    FeatureID  string    // filter by feature
    MinScore   float64   // minimum relevance score
}

type SearchResult struct {
    Artifacts []ScoredArtifact
    Total     int
    Duration  time.Duration
}
```

### Embedding Strategy

- Use OpenAI embeddings API or local model
- Cache embeddings in SQLite BLOB column
- Batch embedding requests for efficiency
- Fallback to FTS-only if embeddings unavailable

### Graph Relations

- feature_id → related workstreams
- ws_id → parent feature
- mentions in content → linked artifacts

## Definition of Done

- [ ] All AC met
- [ ] Tests pass with ≥80% coverage
- [ ] CLI command: `sdp memory search <query>`
- [ ] Precision >80% on test queries
