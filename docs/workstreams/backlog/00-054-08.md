---
ws_id: "00-054-08"
feature_id: "F054"
title: "Scope Collision Detection"
status: "backlog"
priority: "P0"
depends_on: []
blocks: ["00-054-09"]
project_id: "00"
---

# 00-054-08: Scope Collision Detection

## Goal

Detect when parallel workstreams touch the same files. Signal, not block.

## Context

From ROADMAP.md: "Cross-reference scope_files across in-progress workstreams." When 5 agents work in parallel, file conflicts are inevitable. This gives early warning.

Existing infrastructure: workstream parser already extracts `scope_files` into Implementation/Tests arrays.

## Acceptance Criteria

- [ ] AC1: `sdp guard activate` checks for scope overlap with other in-progress workstreams
- [ ] AC2: Overlap detected → warning printed (not error), build continues
- [ ] AC3: `sdp collision check` command lists all current overlaps
- [ ] AC4: Cross-references both `scope_files` from markdown and `scope_files` from frontmatter
- [ ] AC5: Overlap report: which files, which workstreams, severity (same file = high, same dir = low)
- [ ] AC6: Works with existing workstream files in `docs/workstreams/in_progress/`

## Scope Files

**Implementation:**
- sdp-plugin/cmd/sdp/collision.go (new)
- sdp-plugin/internal/collision/detector.go (new)
- sdp-plugin/internal/collision/detector_test.go (new)
- sdp-plugin/cmd/sdp/guard.go (update — add collision check on activate)

**Tests:**
- sdp-plugin/internal/collision/detector_test.go

## Detection Logic

```go
func DetectOverlaps(workstreams []Workstream) []Overlap {
    fileMap := map[string][]string{} // file -> []ws_id
    for _, ws := range workstreams {
        if ws.Status != "in_progress" { continue }
        for _, f := range ws.ScopeFiles {
            fileMap[f] = append(fileMap[f], ws.ID)
        }
    }
    var overlaps []Overlap
    for file, wsIDs := range fileMap {
        if len(wsIDs) > 1 {
            overlaps = append(overlaps, Overlap{
                File: file,
                Workstreams: wsIDs,
            })
        }
    }
    return overlaps
}
```

## Output Format

```
$ sdp collision check
⚠️  Scope overlaps detected:

  internal/evidence/writer.go
    → 00-054-04 (Evidence Log Writer)
    → 00-054-05 (@build Instrumentation)

  1 file overlap across 2 workstreams
  Recommendation: coordinate or sequence these workstreams
```

## Verification

```bash
cd sdp-plugin && go test ./internal/collision/... -v -cover
# Manual: create 2 in-progress WS with overlapping scope, run check
```

## Notes

- ~1.5h work
- INDEPENDENT — no deps on other F054 workstreams
- Uses existing parser.ParseWorkstream() for scope extraction
- Signal, not block — never prevents a build
- Directory-level overlap is "low" severity (common in same feature)
