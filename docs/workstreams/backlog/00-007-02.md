---
ws_id: 00-007-02
feature_id: F007
status: backlog
priority: P1
size: M
depends_on: ["00-007-01"]
---

# 00-007-02: Materialize Envelope to Filesystem + PR Gate Integration

Feature: F007 (sdp_dev-5xd)

## Goal

When the assembler has a complete envelope, write it to `.sdp/evidence/<issueID>.json` in the workspace. PR gate runs unchanged against the materialized file.

## Scope Files

- `internal/evidence/assembler.go` — add materialization
- `internal/evidence/materializer.go` — new (or inline)
- `internal/adapter/workspace.go` — workspace path resolution

## Acceptance Criteria

- [ ] Complete envelope written to `<workspace>/.sdp/evidence/<issueID>.json`
- [ ] File format matches existing evidence template (pr-gate compatible)
- [ ] `sdp-evidence validate --evidence .sdp/evidence/<issueID>.json` passes
- [ ] Assembler calls materializer automatically on completion
- [ ] Git add + commit evidence file to workspace repo (or delegate to PR pipeline)
- [ ] Test: assemble from fragments → materialize → validate with pr-gate

## Out of Scope

- PR creation (existing pr-publish handles this)
- Changing evidence format

## Implementation Notes

- The materialized file is the same format as what `autonomy-worker` produces today — pr-gate doesn't need to change
- Use `workspace.EvidencePath(issueID)` for path resolution
- Consider atomic write (write to temp file, rename) to avoid partial reads
