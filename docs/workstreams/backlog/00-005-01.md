---
ws_id: 00-005-01
feature_id: F005
status: backlog
priority: P1
size: S
depends_on: ["00-004-03"]
---

# 00-005-01: Reviewer Verdict → Coder Rework Loop

Feature: F005 (sdp_dev-6mi)

## Goal

When reviewer verdict is `needs_changes`, transition back to Coding phase with reviewer feedback injected. Max 2 rework iterations.

## Scope Files

- `internal/adapter/agentrun_reconciler.go` — rework transition
- `api/v1alpha1/agentrun_types.go` — add `ReworkCount` to status

## Acceptance Criteria

- [ ] Reviewer verdict `needs_changes` triggers new coder Task with reviewer.json injected
- [ ] `AgentRun.Status.ReworkCount` incremented on each rework
- [ ] ReworkCount >= 2 → AgentRun transitions to Failed with reason `MaxReworkExceeded`
- [ ] Reviewer verdict `approve` → Succeeded (unchanged)
- [ ] Reviewer verdict `reject` → Failed immediately (no rework)
- [ ] Test: rework loop cycles correctly, respects max

## Out of Scope

- Automatic escalation (notify human on repeated failures)
- Changing reviewer behavior

## Implementation Notes

- New coder Task gets annotation `sdp.dev/handoff-reviewer: .sdp/handoff/<id>/reviewer.json`
- Coder prompt should say: "The reviewer found issues. Read reviewer.json and address the findings."
- Keep it simple: rework means a fresh coder Task, not resuming the old one
