# Workstream 00-053-01: Code Analysis Agent

**Feature:** F053 - Component Contract Validation
**Issue:** sdp-ie25.2
**Project ID:** 00
**Status:** Pending
**Priority:** P0 (Parallel Start)

## Overview

Implement automated code analysis agent that extracts API contracts from existing codebases. This enables POST-IMPLEMENTATION contract validation and reverse-engineering of contracts from legacy code.

## Problem Statement

After implementation completes, there's no automated way to:
- Extract what APIs components actually expose
- Compare frontend API calls vs backend routes
- Validate SDK methods match backend endpoints
- Detect integration mismatches without manual testing

## Solution

Code analysis agent that statically analyzes code and extracts:
- Backend: Routes, handlers, request/response schemas
- Frontend: API calls, fetch/axios usage, endpoints
- SDK: Public methods, parameters, return types

## Acceptance Criteria

1. **Code analysis agent** implemented in `src/sdp/agents/code_analyzer.go`
2. Supports Go backend analysis (extract routes from gorilla/mux, gin, echo)
3. Supports TypeScript/JavaScript frontend (extract fetch/axios calls)
4. Supports Python SDK (extract public methods)
5. Outputs extracted contracts to `.contracts/extracted/{component}.yaml`
6. Returns structured data:
   - Endpoint path
   - HTTP method
   - Request schema
   - Response schema
   - File location (for traceability)

## Scope

### In Scope
- Go backend route extraction (gorilla/mux, gin, echo)
- TypeScript/JavaScript frontend API call extraction
- Python SDK method extraction
- Contract output in OpenAPI 3.0 format
- File location tracking

### Out of Scope
- Request/response schema inference (WS 00-053-02)
- Contract validation (WS 00-053-03)
- Multi-language support beyond Go/TS/Python

## Implementation Approach

### Phase 1: Go Backend Analyzer
1. Create `src/sdp/agents/code_analyzer.go`
2. Implement `GoBackendAnalyzer`
3. Parse route registrations:
   - gorilla/mux: `r.HandleFunc("/path", handler)`
   - gin: `router.POST("/path", handler)`
   - echo: `e.POST("/path", handler)`
4. Extract handler function signatures
5. Parse struct tags for request/response types

### Phase 2: Frontend Analyzer
1. Implement `TypeScriptFrontendAnalyzer`
2. Parse fetch/axios calls:
   - `fetch("/api/path", ...)`
   - `axios.post("/api/path", ...)`
3. Extract HTTP method and endpoint
4. Infer request body type from TypeScript types

### Phase 3: SDK Analyzer
1. Implement `PythonSDKAnalyzer`
2. Parse class definitions
3. Extract public methods (no leading underscore)
4. Extract method signatures and docstrings

### Phase 4: Contract Generation
1. Implement `GenerateOpenAPIContract()` method
2. Convert extracted data to OpenAPI 3.0 format
3. Write to `.contracts/extracted/{component}.yaml`

## Dependencies

**UPSTREAM:** None (can start immediately)

**DOWNSTREAM:**
- WS 00-053-02 (Contract generation uses extracted data)
- WS 00-053-03 (Validation uses extracted contracts)

## Testing

### Unit Tests
- `TestGoBackendAnalyzer_ExtractRoutes`
- `TestGoBackendAnalyzer_ParseHandlerSignature`
- `TestTypeScriptFrontendAnalyzer_ExtractFetchCalls`
- `TestPythonSDKAnalyzer_ExtractPublicMethods`

### Integration Tests
- `TestEndToEnd_CodeAnalysis`
- Use sample Go backend code
- Verify extracted routes match expectations
- Verify OpenAPI output valid

## Quality Gates

- Files < 200 LOC
- Cyclomatic complexity < 10
- Test coverage ≥ 80%
- No bare exceptions
- Full type hints

## Definition of Done

- [ ] All acceptance criteria met
- [ ] All tests passing
- [ ] Coverage ≥ 80%
- [ ] Integration test passes with sample code
- [ ] Extracted contracts valid OpenAPI 3.0

## Notes

**Parallel Execution:** Can run in parallel with WS 00-053-00 (Contract Synthesis Agent).

**Framework Support:** Start with gorilla/mux, gin, echo for Go. Add other frameworks as needed.

**Schema Inference:** This workstream focuses on endpoint extraction. Schema inference happens in WS 00-053-02.

## Execution Report Template

```
**Started:** [Timestamp]
**Completed:** [Timestamp]
**Duration:** Xm

**Files Modified:**
- src/sdp/agents/code_analyzer.go (NEW, X LOC)
- src/sdp/agents/code_analyzer_test.go (NEW, Y LOC)

**Test Results:**
- Unit tests: X/Y passing
- Integration tests: A/B passing
- Coverage: Z%

**Extracted Contracts:**
- Sample Go backend: N routes extracted
- Sample TS frontend: N API calls extracted
- Sample Python SDK: N methods extracted

**Challenges:**
- [Any issues encountered]
```
