---
ws_id: 00-051-08
feature_id: F051
title: "Notification Gateway: Event Notifications"
status: backlog
priority: 1
depends_on: [00-051-04]
blocks: []
project_id: sdp
beads_id: sdp-6fx.10
---

## Goal

Create notification gateway for agent and system events.

## Context

Part of F051 Long-term Memory System. Enables notifications for important events (completions, errors, drift detection).

**Related Beads:** sdp-6fx.10 (Notification gateway system)

## Acceptance Criteria

- [ ] AC1: Define notification types and severity levels
- [ ] AC2: Support multiple channels (log, webhook, desktop)
- [ ] AC3: Notification templates with variable substitution
- [ ] AC4: Rate limiting to prevent notification spam
- [ ] AC5: Notification history and replay

## Scope Files

```yaml
scope_files:
  - sdp-plugin/internal/notification/gateway.go        # NEW
  - sdp-plugin/internal/notification/gateway_test.go   # NEW
  - sdp-plugin/internal/notification/channels.go       # NEW
  - sdp-plugin/internal/notification/channels_test.go  # NEW
  - sdp-plugin/cmd/sdp/notify.go                       # NEW
```

## Implementation Notes

### Notification Types

```go
type NotificationType string

const (
    NotifyFeatureComplete NotificationType = "feature_complete"
    NotifyFeatureFailed   NotificationType = "feature_failed"
    NotifyDriftDetected   NotificationType = "drift_detected"
    NotifyReviewComplete  NotificationType = "review_complete"
    NotifyDeployComplete  NotificationType = "deploy_complete"
    NotifyAgentError      NotificationType = "agent_error"
)

type Severity string

const (
    SeverityInfo     Severity = "info"
    SeverityWarning  Severity = "warning"
    SeverityError    Severity = "error"
    SeverityCritical Severity = "critical"
)
```

### Channel Interface

```go
type Channel interface {
    Name() string
    Send(ctx context.Context, n *Notification) error
    IsEnabled() bool
}

// Built-in channels
type LogChannel struct { ... }      // Write to .sdp/notifications.log
type WebhookChannel struct { ... }  // POST to URL
type DesktopChannel struct { ... }  // OS notification (optional)
```

### Rate Limiting

- Max 10 notifications per minute per type
- Debounce similar notifications (same feature, 5 min window)
- Critical notifications bypass rate limit

### Configuration

```yaml
# .sdp/config.yml
notifications:
  enabled: true
  channels:
    - type: log
      enabled: true
    - type: webhook
      enabled: false
      url: https://hooks.slack.com/...
  rate_limit:
    max_per_minute: 10
    debounce_seconds: 300
```

## Definition of Done

- [ ] All AC met
- [ ] Tests pass with â‰¥80% coverage
- [ ] CLI command: `sdp notify test`
- [ ] Log channel works by default
