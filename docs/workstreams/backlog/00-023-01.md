---
ws_id: 00-023-01
feature_id: F023
status: done
priority: P1
size: S
depends_on: ["00-016-04"]
---

# 00-023-01: Scope Diff Checker

Feature: F023 (sdp_dev-tisy)

## Goal

Build scope boundary checker: after each @build, compare `git diff --name-only` against declared `scope_files` from the workstream spec. Flag out-of-scope changes. Maintain allowlist for dependency files that legitimately change (go.sum, go.mod, package-lock.json).

Inspired by Stripe's devbox isolation — we can't isolate the filesystem, but we can detect violations.

## Scope Files

- `internal/guard/scope_check.go` — new: diff vs scope, allowlist, verdict
- `internal/guard/allowlist.go` — new: configurable allowlist (go.sum, go.mod, etc.)
- `internal/guard/scope_check_test.go` — test cases
- `cmd/sdp-guard/main.go` — CLI entry point for `sdp-guard --ws`
- `docs/workstreams/backlog/00-023-01.md` — scope definition

## Acceptance Criteria

- [x] `sdp guard --ws 00-XXX-YY` compares `git diff --name-only` against WS `scope_files`
- [x] Files in scope → PASS
- [x] Files outside scope but in allowlist → PASS with warning
- [x] Files outside scope and not in allowlist → FAIL with list of violating files
- [x] Allowlist configurable via `.sdp/guard-allowlist.yaml`
- [x] Default allowlist: `go.sum`, `go.mod`, `package-lock.json`, `yarn.lock`
- [x] Exit codes: 0 = clean, 1 = out-of-scope changes detected
- [x] Test: in-scope only, in-scope + allowlist, out-of-scope violation

## Out of Scope

- Wiring into `sdp orchestrate --advance` (that's 00-023-02)
- Auto-reverting out-of-scope changes
- Evidence capture of boundary compliance (that's 00-023-02)

## Implementation Notes

The checker reads the workstream spec's `## Scope Files` section to determine the allowed file set. Uses `git diff --name-only HEAD~1` (or `--cached` if pre-commit) to get changed files. Simple set difference.
