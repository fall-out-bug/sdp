---
ws_id: "00-077-04"
feature_id: "F077"
title: "WS: Gateway Lifecycle Hooks"
status: backlog
priority: 2
size: MEDIUM
depends_on: []
blocks: []
---

# WS: Gateway Lifecycle Hooks

**Feature**: F077 - Runtime Hooks Platform
**ID**: 00-077-04
**Priority**: P1
**Depends on**: 00-077-01

## Goal
Add hooks for AI gateway operations (request/response/error).

## Scope Files
- `src/sdp/hooks/gateway.go` (NEW)
- `src/sdp/hooks/gateway_test.go` (NEW)

## Acceptance Criteria
1. `gateway:request` - before AI API call
2. `gateway:response` - after successful API response
3. `gateway:error` - on API failure
4. Access to model ID, tokens, latency
5. Cost tracking integration
6. Rate limit awareness
7. Tests for gateway hooks (>= 80% coverage)

## Out of Scope
- Command hooks (00-077-02)
- Session hooks (00-077-03)

## Implementation Notes
```go
type GatewayEvent struct {
    Model       string
    PromptHash  string
    InputTokens int
    OutputTokens int
    Latency     time.Duration
    Cost        float64
    Error       error
}

func RegisterGatewayHooks(registry *HookRegistry)
```

## Test Strategy
- Unit tests for each hook type
- Test cost calculation
- Test rate limit handling
