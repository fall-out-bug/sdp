---
ws_id: "00-058-04"
feature_id: "F058"
title: "Align workstream frontmatter with sdp drift detect"
status: complete
priority: "P2"
depends_on: []
blocks: []
project_id: "00"
---

# 00-058-04: Align workstream frontmatter with sdp drift detect

## Goal

Fix the drift detection tool to accept both `feature` and `feature_id` field names in workstream YAML frontmatter, enabling mandatory drift checks in review protocol.

## Context

The `sdp drift detect` command fails with "missing required field: feature" because:
- Workstream files use `feature_id: "F058"` (more explicit naming)
- Parser's frontmatter struct expects `feature:` only
- This prevents drift detection from running on existing workstreams

**Decision:** Support both field names for backward compatibility. Add `FeatureID` field as primary, with `Feature` as alias.

## Acceptance Criteria

- [x] AC1: Parser accepts both `feature` and `feature_id` in YAML frontmatter
- [x] AC2: Existing workstream files continue to work without modification
- [x] AC3: `sdp drift detect 00-058-01` succeeds
- [x] AC4: Parser tests cover both field name variants

## Implementation Notes

Added support for both `feature` and `feature_id` field names:
- Added `FeatureID` field with `yaml:"feature_id"` tag to frontmatter struct
- Kept `Feature` field with `yaml:"feature"` tag for backward compatibility
- Added `getFeature()` helper method that prefers `feature_id`, falls back to `feature`
- Updated `ParseWorkstream()` to use `getFeature()` helper
- Updated validation error message: "missing required field: feature or feature_id"

## Verification

- All parser tests pass (including new tests for feature_id handling)
- `sdp drift detect 00-058-01` successfully parses workstream with `feature_id`
- Existing workstream files (like 00-057-15.md) continue to work without modification

## Commits

- `bc5dce5`: "feat(parser): support both feature and feature_id in workstream frontmatter"

## Scope Files

**Implementation:**
- `sdp-plugin/internal/parser/schema.go` (modify)
  - Add `FeatureID` field with `yaml:"feature_id"` tag
  - Keep `Feature` field with `yaml:"feature"` tag
  - Update `ParseWorkstream()` to prefer `FeatureID`, fallback to `Feature`

**Tests:**
- `sdp-plugin/internal/parser/workstream_test.go` (modify)
  - Add test case for `feature_id` field
  - Add test case for `feature` field (backward compat)
  - Add test case for both fields present (prefer `feature_id`)

**Verification:**
- Run `sdp drift detect 00-058-01` in sdp-F058 worktree
- Verify no "missing required field" error

## Notes

- Do NOT modify existing workstream files in sdp-F058
- The fix is in the parser, not the data
- This enables drift detection for all existing F058 workstreams
- Later workstreams can standardize on preferred field name
