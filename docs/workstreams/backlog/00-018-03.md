---
ws_id: 00-018-03
feature_id: F018
status: done
priority: P2
size: S
depends_on: ["00-018-02"]
---

# 00-018-03: Phantom sdp guard context/branch/complete/finding (Follow-up)

Feature: F018 (sdp_dev-tivd)

## Goal

Complete phantom CLI removal per Phase 0 exit criteria. Replace `sdp guard context check`, `branch check`, `complete`, `finding list/resolve` with checkpoint-based validation and `bd list`. Aligned with oneshot-autonomous-design: "Defensive branch check через checkpoint (не через sdp guard context go)".

## Scope Files

- `sdp/prompts/skills/build/SKILL.md` — remove phantom, use checkpoint
- `sdp/prompts/agents/orchestrator.md` — checkpoint-based branch validation
- `.opencode/skills/build/SKILL.md` — mirror sdp/prompts
- `.opencode/agents/orchestrator.md` — mirror sdp/prompts
- `hooks/pre-build.sh` — remove context check
- `scripts/hooks/pre-build.sh` — same
- `sdp/CLAUDE.md` — remove sdp guard finding list/resolve
- `docs/security/2026-02-23-pre-existing-phantom-cli-analysis.md` — reference

## Acceptance Criteria

- [x] Build skill: no `sdp guard context check`, `branch check`, `complete`; use checkpoint branch check (lines 39-44), `sdp guard deactivate` instead of complete
- [x] Orchestrator: replace context check/go with checkpoint-based `git checkout $(jq -r .branch .sdp/checkpoints/...)` when branch mismatch
- [x] Hooks: remove `sdp guard context check` (redundant with activate)
- [x] sdp/CLAUDE.md: remove `sdp guard finding list/resolve` from Guard Commands table
- [x] Grep: `rg 'sdp guard (context|branch check|complete|finding)' sdp/ .opencode/ hooks/ scripts/` returns empty (except analysis doc)

## Out of Scope

- Implementing phantom commands (Option B)
- .cursor copies (if symlinks, follow sdp canonical)
