---
ws_id: "00-056-01"
feature_id: "F056"
title: "Review & Deploy Instrumentation"
status: "completed"
priority: "P1"
depends_on: ["00-054-05"]
blocks: ["00-056-04"]
project_id: "00"
---

# 00-056-01: Review & Deploy Instrumentation

## Goal

Instrument `@review` and `@deploy` skills to emit evidence events. These complete the generation → verification → approval chain started by `@build` in F054.

## Context

`@review` calls multi-agent quality check (QA, Security, DevOps, SRE, TechLead, Documentation). Each reviewer finding should be a verification event. `@deploy` merges code and should emit an approval event.

## Acceptance Criteria

- [x] AC1: `sdp verify` (called by `@review`) emits `verification` event per gate result
- [x] AC2: Verification events include actual reviewer output (findings, severity)
- [x] AC3: `@deploy` merge step emits `approval` event (who approved, gates passed)
- [x] AC4: Approval event includes merge target branch and commit SHA
- [x] AC5: Evidence chain: `@build` generation → `@review` verification → `@deploy` approval
- [x] AC6: Tests for new event emissions

## Scope Files

**Implementation:**
- sdp-plugin/cmd/sdp/verify.go (update — add review evidence)
- sdp-plugin/internal/evidence/emitter.go (update — add review/deploy helpers)
- sdp-plugin/internal/evidence/emitter_test.go (update)

**Tests:**
- sdp-plugin/internal/evidence/emitter_test.go

## Notes

- ~2h work
- Highest leverage after `@build` — completes the core chain
- `@review` already calls CLI commands — just add evidence emit

---

## Execution Report

**Date:** 2026-02-15

### Goal Status: ACHIEVED

All 6 acceptance criteria verified and passing.

### Changed Files

- `sdp-plugin/cmd/sdp/deploy_test.go` (NEW - 140 lines)

### Implementation Summary

The core implementation was already in place from previous work:

1. **AC1/AC2**: `verify.go` already emits verification events with findings via `VerificationEventWithFindings()`
2. **AC3/AC4**: `deploy.go` already emits approval events via `ApprovalEvent()`
3. **AC5**: Evidence chain verified via `TestFullPipelineEvidenceChain` in integration_test.go
4. **AC6**: Added `deploy_test.go` with tests for:
   - `TestDeployCmd_ApprovalEvent`: Verifies approval event emission with correct fields
   - `TestDeployCmd_DefaultValues`: Tests default value handling
   - `TestDeployCmd_EvidenceDisabled`: Tests skip behavior when evidence disabled

### Self-Check Results

- Tests pass: PASS (go test ./cmd/sdp/... ./internal/evidence/...)
- Coverage >= 80%: PASS (evidence: 84.8%, verify: 85.5%)
- Regression tests: PASS
- Linters: PASS (go vet ./cmd/sdp/...)
- No TODO/FIXME: PASS
- File sizes < 200 LOC: PASS (deploy_test.go: 140 lines)
