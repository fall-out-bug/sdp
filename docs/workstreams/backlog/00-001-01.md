---
ws_id: 00-001-01
feature_id: F001
status: done
priority: P0
size: S
depends_on: []
---

# 00-001-01: Formalize Evidence Envelope JSON Schema

Feature: F001 (sdp_dev-8gt)

## Goal

Derive a formal JSON Schema for the 9-section evidence envelope from existing implementation.

## Scope Files

- `specs/strict-evidence-template.json` — current template
- `internal/evidence/strict.go` — validation logic
- `internal/artifact/` — provenance types

## Acceptance Criteria

- [x] JSON Schema file created that covers all 9 sections: intent, plan, execution, verification, review, risk_notes, boundary, provenance, trace
- [x] Schema validates against existing evidence files in `.sdp/evidence/` or test fixtures
- [x] Schema includes `$schema` and `$id` for reference
- [x] Unit test: `validate` against schema matches `internal/evidence.Validate` behavior

## Out of Scope

- Publishing to sdp repo (00-001-02)
- Changing the evidence format or adding new sections

## Implementation Notes

- Use `encoding/json` struct tags and `reflect` or manual mapping to derive schema from Go types
- Or handcraft schema from `strict-evidence-template.json` structure
- Ensure `provenance.hash`, `provenance.hash_prev` chain semantics are documented

---

## Execution Report

**Completed:** 2026-02-22

**Deliverables:**
- `schema/evidence-envelope.schema.json` — JSON Schema for 9-section evidence envelope with `$schema`, `$id` (https://sdp.dev/schema/evidence-envelope/v1)
- `internal/evidence/schema_test.go` — Tests: `TestSchemaValidationMatchesEvidenceValidate` (schema vs evidence.Validate agreement), `TestSchemaValidatesTemplate` (template validates)
- Added `github.com/santhosh-tekuri/jsonschema/v5` dependency

**Verification:**
- `go test ./internal/evidence/ -run 'TestSchema|TestValidateStrict'` — PASS

---

### Review Results

**Reviewed by:** Cursor /review
**Date:** 2026-02-23

| # | Check | Status |
|---|-------|--------|
| 0 | Goal Achieved | PASS |
| 1 | Tests pass | PASS |
| 2 | Coverage >= 80% | PASS (80.5%) |
| 3 | Regression | PASS |
| 4 | Linters (go vet) | PASS |
| 5 | Type hints | N/A (Go) |
| 6 | No TODO/FIXME | PASS |
| 7 | File size < 200 LOC | PASS |
| 8 | Clean Architecture | PASS |
| 9 | Docstrings | PASS |
| 10 | Type annotations | N/A (Go) |
| 11 | Execution Report | PASS |

**Verdict:** APPROVED
