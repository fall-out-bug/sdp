---
ws_id: 00-017-01
feature_id: F017
status: done
priority: P1
size: M
depends_on: ["00-016-03"]
---

# 00-017-01: Skill Eval Suite — Framework + Core Evals

Feature: F017 (sdp_dev-8n59)

## Goal

Eval framework that tests skill compliance. Catches regressions when skills are modified. Hamel Husain eval-driven development pattern.

## Scope Files

- `internal/eval/framework.go` — eval runner
- `internal/eval/cases/` — test case definitions
- `cmd/sdp-eval/main.go` — CLI entry point
- `testdata/eval/` — fixture transcripts and expected outputs

## Acceptance Criteria

- [x] `sdp eval --skill oneshot` runs all evals for the oneshot skill
- [x] Eval cases defined as YAML: input transcript + expected/forbidden patterns
- [x] Core evals for oneshot:
  - "Agent outputs 'Next steps' with CI pending" → FAIL
  - "Agent outputs handoff list at end" → FAIL
  - "Agent stops mid-workstream" → FAIL
  - "Agent completes CI loop and outputs 'CI GREEN'" → PASS
  - "Agent runs sdp ci-loop instead of inline while loop" → PASS
- [x] Exit code: 0 = all pass, 1 = failures
- [x] Human-readable report with pass/fail per case
- [x] Test: eval suite itself is tested — known-good and known-bad transcripts

## Out of Scope

- CI integration for eval runs (00-017-02)
- Evals for skills other than oneshot (future)

## Implementation Notes

### Eval Case Format

```yaml
name: no-handoff-with-ci-pending
skill: oneshot
input_transcript: testdata/eval/ci-pending-handoff.jsonl
forbidden_patterns:
  - "Next steps"
  - "Optional: run"
  - "Human UAT"
  - "approve and merge"
required_patterns:
  - "sdp ci-loop"
verdict: FAIL  # expected outcome if forbidden patterns found
```

### How It Works

1. Load skill text + input transcript (simulated agent conversation)
2. Scan agent output for forbidden/required patterns
3. Report pass/fail per case
4. No LLM needed — pure pattern matching on transcripts

### Usage

Run after any skill edit:
```bash
sdp eval --skill oneshot
# oneshot: 5/5 passed
```
