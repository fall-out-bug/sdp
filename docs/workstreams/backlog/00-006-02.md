---
ws_id: 00-006-02
feature_id: F006
status: backlog
priority: P1
size: M
depends_on: ["00-006-01"]
---

# 00-006-02: Evidence Fragment Publisher Library

Feature: F006 (sdp_dev-e5n)

## Goal

Library that agent pods use to publish evidence fragments to JetStream. Each fragment includes the section data + provenance hash for chain validation.

## Scope Files

- `internal/evidence/publisher.go` — new
- `internal/evidence/publisher_test.go` — new
- `internal/evidence/fragment.go` — new: fragment types

## Acceptance Criteria

- [ ] `evidence.Publisher` with `PublishFragment(ctx, issueID, section, data, provenance)` method
- [ ] Fragment message includes: `{issue_id, section, data, provenance: {hash, hash_prev, sequence}}`
- [ ] Publishes to `sdp.evidence.<issueID>.<section>` via JetStream
- [ ] Provenance hash computed using `artifact.ComputeHash()` for chain continuity
- [ ] Test: publish 3 fragments, verify all arrive with correct subjects and provenance chain
- [ ] Integrates with existing `bus.Bus` interface

## Out of Scope

- Assembler (00-007-*)
- Injecting publisher into agent pods (that's adapter-controller's job)

## Implementation Notes

- Fragment is a self-contained message: the assembler doesn't need to know anything about the publishing pod
- Use `json.Marshal` with canonical ordering for deterministic hashing
- Consider a `PublishIntent`, `PublishPlan`, etc. convenience methods
