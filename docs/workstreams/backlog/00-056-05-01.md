---
ws_id: "00-056-05"
feature_id: "F056"
title: "Refactor emitter.go to â‰¤200 LOC"
status: "backlog"
priority: "P3"
depends_on: []
blocks: []
project_id: "00"
---

# 00-056-05: Refactor emitter.go to â‰¤200 LOC

## Goal

### ðŸŽ¯ Goal

Reduce `sdp-plugin/internal/evidence/emitter.go` to â‰¤200 lines to satisfy the project quality gate (max 200 LOC per file). Move event builder functions into new files in the same package without changing public API or behavior.

## Context

Review finding sdp-5wqi: emitter.go is 281 LOC. Split into multiple files (e.g. emit core, plan events, verification/approval events, decision/lesson events) so each file is â‰¤200 LOC.

## Acceptance Criteria

- [x] AC1: emitter.go â‰¤200 LOC (counted by `wc -l`) â€” 91 LOC
- [x] AC2: All existing tests pass (`go test ./internal/evidence/...`)
- [x] AC3: No change to public API (same function names, signatures, package `evidence`)
- [x] AC4: Coverage of evidence package â‰¥80% â€” 86.3%

## Scope Files

**Implementation:**
- sdp-plugin/internal/evidence/emitter.go (reduce to â‰¤200 LOC)
- sdp-plugin/internal/evidence/plan.go (new â€” plan event builders)
- sdp-plugin/internal/evidence/events.go (new â€” generation, verification, approval, skill builders)
- sdp-plugin/internal/evidence/decision_lesson.go (new â€” decision, lesson builders)

**Tests:**
- sdp-plugin/internal/evidence/emitter_test.go (unchanged; may add test that emitter.go â‰¤200 if desired)

## Notes

- Pure refactor: no behavior change. Callers import `evidence` and call same functions.
- New files must be in package `evidence`.

---

## Execution Report

| Step | Result |
|------|--------|
| Pre-build | âœ… PASSED |
| Guard | âœ… Activated 00-056-05 |
| Refactor | emitter.go â†’ 91 LOC; plan.go, events.go, decision_lesson.go added |
| Tests | âœ… All pass (evidence 86.3% coverage) |
| Post-build | âœ… go build ./...; go test ./... -short |
| AC1 | emitter.go 91 LOC (â‰¤200) |
| AC2 | go test ./internal/evidence/ â€” PASS |
| AC3 | Public API unchanged (same package, same exports) |
| AC4 | 86.3% â‰¥ 80% |
