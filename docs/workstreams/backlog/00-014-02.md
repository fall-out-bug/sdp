---
ws_id: 00-014-02
feature_id: F014
status: done
priority: P0
size: M
depends_on: ["00-014-01"]
---

# 00-014-02: CI Loop CLI — Auto-Fix Engine

Feature: F014 (sdp_dev-3vtt)

## Goal

When `sdp ci-loop` classifies a failure as auto-fixable, apply the fix, commit, push, and re-poll.

## Scope Files

- `internal/ciloop/fixer.go` — apply fixes based on classification
- `internal/ciloop/fixer_test.go` — test fix patterns
- `cmd/sdp-ci-loop/main.go` — wire fixer into poll loop

## Acceptance Criteria

- [x] Go build failure → parse error, apply fix, `git commit -m "fix(ci): ..."`, `git push`
- [x] Go test failure → parse failing test, attempt fix, commit, push
- [x] k8s-validate failure → parse YAML error, fix manifest, commit, push
- [x] After fix+push: increment iteration, wait PollDelay (default 60s), re-poll
- [x] CI_ITER >= max-iter → exit 2 (exceeded)
- [x] Decision log entry for each fix: `sdp decisions log --decision "AUTO-FIX" --rationale "..."`
- [x] Test: fix → push → green path; fix → push → still failing → escalate path

## Out of Scope

- LLM-based fix classification (keep it rule-based for v1)
- Complex refactoring fixes

## Implementation Notes

- Parse `gh run view --log-failed` output for error patterns
- Go errors: regex for `cannot find package`, `undefined:`, test assertion failures
- K8s errors: YAML parse errors, missing fields
- Each fix is a single commit on the feature branch
- If fix attempt fails (can't parse, can't apply), escalate immediately
