---
ws_id: 00-050-08
parent: sdp-79u
feature: F050
status: backlog
size: MEDIUM
project_id: 00
---

## WS-00-050-08: Telemetry Analyzer (Pattern Detection)

### üéØ Goal

Analyze telemetry patterns and generate insights. Enable continuous protocol improvement by identifying friction points and auto-generating workstream proposals.

**What must WORK after completing this WS:**
- `sdp telemetry insights --days 30` generates weekly report
- Identify top 5 friction points with occurrence counts
- Generate workstream proposals for high-severity patterns
- Calculate skill usage statistics (@build, @review, @oneshot)
- Analyze escalation trends (via `bd history` or JSON)

**Acceptance Criteria:**
- [ ] AC1: Insights command generates weekly report
- [ ] AC2: Top 5 friction points identified with counts
- [ ] AC3: Workstream proposals generated for HIGH severity
- [ ] AC4: Skill usage statistics calculated
- [ ] AC5: Escalation trends analyzed
- [ ] Coverage ‚â• 80%

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### üìã Contracts

**Technical Constraints:**
- Must parse telemetry from all workstreams
- Must aggregate by time periods (week, month)
- Must detect patterns (group by friction point)
- Must generate workstream proposals (00-900-XX format)

---

### üîå Interfaces

```go
package telemetry

type FrictionPattern struct {
    Description string
    Severity    string
    Count       int
    FirstSeen   time.Time
    LastSeen    time.Time
}

type SkillUsage struct {
    Skill      string
    Invocations int
    SuccessRate float64
    AvgDuration time.Duration
}

type EscalationTrend struct {
    Period      string
    Escalations int
    TopReason   string
}

type InsightsReport struct {
    Period           string
    FrictionPatterns []FrictionPattern
    SkillUsage       []SkillUsage
    EscalationTrends []EscalationTrend
    ProposedWS       []string
}

type Analyzer struct {
    workstreamsDir string
}

func NewAnalyzer(wsDir string) (*Analyzer, error)
func (a *Analyzer) GenerateInsights(days int) (*InsightsReport, error)
func (a *Analyzer) detectFrictionPatterns() ([]FrictionPattern, error)
func (a *Analyzer) calculateSkillUsage() ([]SkillUsage, error)
func (a *Analyzer) analyzeEscalations() ([]EscalationTrend, error)
func (a *Analyzer) generateProposals(patterns []FrictionPattern) []string
```

---

### üìÅ Scope Files

**Implementation:**
- `internal/telemetry/analyzer.go`
- `internal/telemetry/patterns.go`
- `internal/telemetry/skills.go`
- `internal/telemetry/proposals.go`
- `cmd/sdp/commands/telemetry.go` (extend)

**Tests:**
- `internal/telemetry/analyzer_test.go`

---

### ‚úÖ Testing

**Unit Tests:**
```bash
# Pattern detection
TestDetectFrictionPatterns()
TestPatternGrouping()
TestSeverityClassification()

# Skill usage
TestCalculateSkillUsage()
TestSuccessRateCalculation()

# Proposal generation
TestGenerateProposals()
TestProposalNaming()
```

**Integration Tests:**
```bash
# Generate insights report
sdp telemetry insights --days 30

# Expected output:
# Telemetry Insights: Week of 2026-01-29
#
# ## Friction Points (Top 5)
# 1. Quality gate failed 2x due to missing type hints (7 occurrences)
# 2. Documentation inconsistent with actual workflow (5 occurrences)
#
# ## Suggested Protocol Improvements
# 1. **00-900-01**: Add pre-build type hint validation to guard system
# 2. **00-900-02**: Update docs/workflow-decision.md based on real usage
#
# ## Skill Usage
# - @build: 42 invocations, 95% success rate
# - @review: 28 invocations, 89% success rate
```

---

### üîç Verification

**Pre-build:**
- [ ] Review telemetry parsing logic
- [ ] Verify pattern grouping algorithm
- [ ] Check proposal generation rules
- [ ] Test escalation trend calculation

**Post-build:**
```bash
# Run tests
go test ./internal/telemetry/... -v -cover

# Manual integration test
sdp telemetry insights --days 30

# Create dummy workstreams with telemetry
mkdir -p /tmp/test-ws
echo "telemetry:" > /tmp/test-ws/00-001-01.md
echo "  friction_points:" >> /tmp/test-ws/00-001-01.md
echo "    - description: 'Test friction'" >> /tmp/test-ws/00-001-01.md
echo "      severity: 'HIGH'" >> /tmp/test-ws/00-001-01.md

sdp telemetry insights --workstreams /tmp/test-ws
```

---

### üìù Notes

**Dependencies:** 00-050-07

**Context:**
Telemetry analyzer (500 LOC). Recommendation from deep-thinking: "Telemetry-driven insights enable continuous protocol improvement (auto-generate workstream proposals)."

**Key Decisions:**
- Parse all workstreams for telemetry
- Group by friction point description
- Severity levels: HIGH (‚â•7), MEDIUM (4-6), LOW (<4)
- Workstream proposals: 00-900-01, 00-900-02, etc.

**Risks:**
- Workstream parsing fails
- Pattern detection false positives
- Proposal generation creates duplicates
- Escalation data incomplete

**Mitigations:**
- Validate telemetry format before parsing
- Tune pattern grouping thresholds
- Check existing proposals before generating
- Fallback gracefully if escalation data missing

**Pattern Detection Algorithm:**
1. Collect all friction points from telemetry
2. Group by description (exact match)
3. Count occurrences per pattern
4. Classify severity (HIGH/MEDIUM/LOW)
5. Sort by count (descending)
6. Return top 5

**Proposal Generation Rules:**
- HIGH severity ‚Üí Generate proposal
- MEDIUM severity ‚Üí Generate if count ‚â•5
- LOW severity ‚Üí Skip
- Check existing proposals (avoid duplicates)

**Insights Report Format:**
```markdown
# Telemetry Insights: Week of 2026-01-29

## Friction Points (Top 5)
1. Quality gate failed 2x due to missing type hints (7 occurrences)
2. Documentation inconsistent with actual workflow (5 occurrences)

## Suggested Protocol Improvements
1. **00-900-01**: Add pre-build type hint validation to guard system
2. **00-900-02**: Update docs/workflow-decision.md based on real usage

## Skill Usage
- @build: 42 invocations, 95% success rate
- @review: 28 invocations, 89% success rate

## Escalation Trends
- Week 4: 3 escalations (reason: blocking bugs)
```
