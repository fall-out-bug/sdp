---
ws_id: "00-064-00"
feature_id: "F064"
title: "Split Large guard.go File"
status: backlog
priority: 2
size: LARGE
depends_on: []
blocks: ["00-064-01", "00-064-02", "00-064-03", "00-064-04"]
---

# 00-064-00: Split Large guard.go File

> **Status:** Open
> **Priority:** P1 (High)
> **Type:** Refactor
> **Beads ID:** sdp-yxrn

## Goal

Split `sdp-plugin/cmd/sdp/guard.go` (397 LOC) into smaller modules to comply with 200 LOC quality gate.

## Acceptance Criteria

1. **guard.go** retained as CLI entry point (< 150 LOC)
   - Contains only command registration and delegation
   - No business logic

2. **guard_activate.go** extracted (activate subcommand)
   - `guardActivate()` function
   - Evidence emission on activation
   - Collision and failure warnings

3. **guard_check.go** extracted (check subcommand)
   - `guardCheck()` function
   - Both staged and single-file modes
   - JSON output support

4. **guard_status.go** extracted (status subcommand)
   - `guardStatus()` function
   - State loading and display

5. **guard_deactivate.go** extracted (deactivate subcommand)
   - `guardDeactivate()` function

6. **guard_warnings.go** extracted (warning helpers)
   - `warnSimilarFailures()`
   - `warnContractViolations()`
   - `printHumanReadableResult()`

## Input Files

- `sdp-plugin/cmd/sdp/guard.go` (397 LOC)

## Output Files

- `sdp-plugin/cmd/sdp/guard.go` (~100 LOC)
- `sdp-plugin/cmd/sdp/guard_activate.go`
- `sdp-plugin/cmd/sdp/guard_check.go`
- `sdp-plugin/cmd/sdp/guard_status.go`
- `sdp-plugin/cmd/sdp/guard_deactivate.go`
- `sdp-plugin/cmd/sdp/guard_warnings.go`

## Steps

1. Create test file `cmd/sdp/guard_test.go`
2. Write failing test for each subcommand (RED phase)
3. Extract `guard_activate.go` (GREEN phase)
4. Extract `guard_check.go` (GREEN phase)
5. Extract `guard_status.go` (GREEN phase)
6. Extract `guard_deactivate.go` (GREEN phase)
7. Extract `guard_warnings.go` (GREEN phase)
8. Refactor guard.go to delegation only (REFACTOR phase)
9. Run `go test ./cmd/sdp/... -v -race -cover`
10. Verify all files < 200 LOC

## Notes

- Existing `internal/guard/skill.go` handles the skill logic
- This refactor is purely about CLI command organization
- Keep imports and package structure intact
