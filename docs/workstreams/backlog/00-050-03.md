---
ws_id: 00-050-03
parent: sdp-79u
feature: F050
status: backlog
size: SMALL
project_id: 00
---

## WS-00-050-03: Beads CLI Wrapper (Thin Layer)

### ğŸ¯ Goal

Implement thin wrapper functions for Beads CLI commands. Enable task tracking integration with JSON fallback for environments without Beads.

**What must WORK after completing this WS:**
- ReadyTasks() calls `bd ready --json`, parses output
- UpdateStatus() calls `bd update <id> --status <status>`
- CreateTask() calls `bd create` with metadata
- Fallback to JSON if Beads not installed
- All functions return Go errors (not panics)

**Acceptance Criteria:**
- [ ] AC1: ReadyTasks() executes `bd ready --json` and returns []Task
- [ ] AC2: UpdateStatus() calls `bd update` with status parameter
- [ ] AC3: CreateTask() calls `bd create` with metadata
- [ ] AC4: Fallback to JSON file if Beads not installed
- [ ] AC5: All functions return structured errors
- [ ] Coverage â‰¥ 80%

**âš ï¸ WS is NOT complete until Goal is achieved (all AC âœ…).**

---

### ğŸ“‹ Contracts

**Technical Constraints:**
- Must use os/exec for Beads CLI execution
- Must parse JSON output from `bd --json` flag
- Must implement fallback mechanism to JSON files
- Must not panic (always return errors)

---

### ğŸ”Œ Interfaces

```go
package beads

type Task struct {
    ID       string
    Title    string
    Status   string
    Priority string
}

type Wrapper struct {
    beadsPath string
    useJSON   bool
}

func NewWrapper() (*Wrapper, error)
func (w *Wrapper) ReadyTasks() ([]Task, error)
func (w *Wrapper) UpdateStatus(id, status string) error
func (w *Wrapper) CreateTask(title, status string) error
func (w *Wrapper) detectBeads() bool
```

---

### ğŸ“ Scope Files

**Implementation:**
- `internal/beads/wrapper.go`
- `internal/beads/fallback.go`
- `internal/beads/task.go`

**Tests:**
- `internal/beads/wrapper_test.go`

---

### âœ… Testing

**Unit Tests:**
```bash
# Beads detection
TestDetectBeadsInstalled()
TestDetectBeadsNotInstalled()

# ReadyTasks parsing
TestReadyTasksSuccess()
TestReadyTasksJSONFallback()
TestReadyTasksError()

# UpdateStatus
TestUpdateStatusSuccess()
TestUpdateStatusJSONFallback()

# CreateTask
TestCreateTaskSuccess()
TestCreateTaskJSONFallback()
```

**Integration Tests:**
```bash
# With real Beads installation
go test ./internal/beads/... -run TestIntegrationWithBeads

# Without Beads (JSON fallback)
go test ./internal/beads/... -run TestIntegrationJSONFallback
```

---

### ğŸ” Verification

**Pre-build:**
- [ ] Review Beads CLI command syntax
- [ ] Verify JSON parsing logic
- [ ] Check fallback file paths

**Post-build:**
```bash
# Run tests
go test ./internal/beads/... -v -cover

# Manual integration test (with Beads installed)
bd create "Test task"
./sdp beads ready  # Should list the task

# Manual fallback test (without Beads)
./sdp beads ready  # Should read from JSON file
```

---

### ğŸ“ Notes

**Dependencies:** 00-050-01

**Context:**
Thin wrapper layer (150 LOC) vs full client. Beads CLI already handles task management complexity. We only need 5-6 core functions.

**Key Decisions:**
- JSON fallback for environments without Beads
- Only 5-6 wrapper functions (not full API)
- Exec-based approach (not Go client library)
- Structured errors (no panics)

**Risks:**
- Beads CLI not installed
- Beads version incompatible
- JSON output format changes

**Mitigations:**
- Detect Beads installation on wrapper init
- Version check with warning message
- Fallback to JSON files
