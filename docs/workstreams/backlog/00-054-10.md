---
ws_id: "00-054-10"
feature_id: "F054"
title: "Decision Capture & Search"
status: "backlog"
priority: "P0"
depends_on: ["00-054-04"]
blocks: ["00-054-11"]
project_id: "00"
---

# 00-054-10: Decision Capture & Search

## Goal

Capture decisions as evidence events and enable search/recall. "We decided X because Y" — recorded automatically during `@design` and `@build`, searchable with `sdp log show --type=decision`.

## Context

Old F051 had a separate `.sdp-memory/` system with 14 workstreams. New approach: decisions are evidence events. One log, one reader, one schema. Memory IS the evidence log.

Existing `internal/decision/` package already has a Decision struct and logger. Extend it to emit evidence events instead of writing to a separate JSONL.

## Acceptance Criteria

- [ ] AC1: `sdp decisions log` creates a `decision` event in the evidence log
- [ ] AC2: `@design` emits `decision` events for architecture choices (auto-capture)
- [ ] AC3: `@build` emits `decision` events for implementation choices (auto-capture)
- [ ] AC4: `sdp log show --type=decision` lists all decisions
- [ ] AC5: `sdp log show --type=decision --search "authentication"` full-text search
- [ ] AC6: Decision fields: question, choice, rationale, alternatives, confidence, tags
- [ ] AC7: Decision reversal: `reverses` field links to previous decision being overturned
- [ ] AC8: Backward compatible with existing `internal/decision/` package

## Scope Files

**Implementation:**
- sdp-plugin/internal/evidence/emitter.go (update — add EmitDecision helper)
- sdp-plugin/internal/evidence/browser.go (update — decision search)
- sdp-plugin/cmd/sdp/decisions.go (update — emit to evidence log)
- sdp-plugin/internal/decision/logger.go (update — bridge to evidence writer)
- sdp-plugin/internal/evidence/emitter_test.go (update)

**Tests:**
- sdp-plugin/internal/evidence/emitter_test.go

## Example Usage

```bash
# Manual decision logging
sdp decisions log \
  --question "How to handle auth?" \
  --choice "JWT with refresh tokens" \
  --rationale "Stateless, scales horizontally" \
  --alternatives "Sessions,OAuth2 only" \
  --tags "security,architecture"

# Search decisions
sdp log show --type=decision --search "database"

# See all decisions for a feature
sdp log show --type=decision --ws "00-054-*"
```

## Notes

- ~2h work
- Bridge existing `internal/decision/` to evidence writer (don't delete, adapt)
- Auto-capture: `@design` and `@build` emit decisions at key choice points
- Search: reuse evidence browser filtering (WS-07/F057-03)
- This replaces F051 Phase 1 (decision model + storage + search) in 1 WS instead of 4
