---
ws_id: 00-023-02
feature_id: F023
status: done
priority: P1
size: S
depends_on: ["00-023-01"]
---

# 00-023-02: Wire Scope Enforcement into Orchestrator

Feature: F023 (sdp_dev-h3y5)

## Goal

Integrate `sdp guard` scope checker into `sdp orchestrate --advance`. After each @build phase, automatically run scope check. Out-of-scope changes block advance and classify as escalation. Evidence captures boundary compliance.

## Scope Files

- `internal/orchestrate/state_machine.go` — add guard check after build phase
- `internal/orchestrate/advance.go` — wire `sdp guard` into advance logic
- `internal/orchestrate/advance_test.go` — test advance with clean scope, violation blocked
- `cmd/sdp-orchestrate/main.go` — add --skip-guard, run guard before advance
- `docs/workstreams/backlog/00-023-02.md` — scope definition

## Acceptance Criteria

- [x] `sdp orchestrate --advance` runs `sdp guard` after each @build completion
- [x] Guard PASS → advance to next phase
- [x] Guard FAIL → block advance, log violating files, create escalation bead
- [x] Evidence envelope includes `boundary_compliance` section with scope check result
- [x] Escalation bead: `bd create --title="SCOPE VIOLATION: {ws_id} touched {files}" --priority=1`
- [x] `--skip-guard` flag available for override (escape hatch)
- [x] Test: advance with clean scope, advance with violation → blocked

## Out of Scope

- Auto-reverting changes (manual resolution)
- Pre-commit hook integration (future)
