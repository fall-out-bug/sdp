---
ws_id: 00-050-12
parent: sdp-79u
feature: F050
status: backlog
size: SMALL
project_id: 00
---

## WS-00-050-12: CLI Polish + Cross-Platform Builds

### üéØ Goal

Implement production-ready CLI with polish features. Enable cross-platform deployment with shell completion, color output, progress bars, and static binaries.

**What must WORK after completing this WS:**
- Shell completion (bash, zsh, fish)
- Color output (lipgloss library)
- Progress bars for long operations
- Cross-platform builds (Linux, macOS, Windows)
- Binary size ‚â§20MB (stripped)

**Acceptance Criteria:**
- [ ] AC1: Bash completion works with `source` command
- [ ] AC2: Zsh completion works with `source` command
- [ ] AC3: Fish completion works with `source` command
- [ ] AC4: Color output displays with lipgloss
- [ ] AC5: Progress bars display for long operations
- [ ] AC6: Cross-platform builds succeed (Linux, macOS, Windows)
- [ ] AC7: Binary size ‚â§20MB (stripped)
- [ ] Coverage ‚â• 80%

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### üìã Contracts

**Technical Constraints:**
- Must use lipgloss for color output
- Must use bubbletea for progress bars
- Must generate completion scripts for bash, zsh, fish
- Must build static binaries with `-ldflags "-s -w"`

---

### üîå Interfaces

```go
package commands

// Shell completion
func NewCompletionCmd() *cobra.Command
func generateBashCompletion() (string, error)
func generateZshCompletion() (string, error)
func generateFishCompletion() (string, error)

// Color output
func NewColorizer() *Colorizer
func (c *Colorizer) Success(msg string) string
func (c *Colorizer) Error(msg string) string
func (c *Colorizer) Warning(msg string) string

// Progress bars
func NewProgressBar(title string) *ProgressBar
func (p *ProgressBar) Start()
func (p *ProgressBar) Increment()
func (p *ProgressBar) Stop()
```

---

### üìÅ Scope Files

**Implementation:**
- `Makefile`
- `cmd/sdp/commands/completion.go`
- `cmd/sdp/commands/color.go`
- `cmd/sdp/commands/progress.go`
- Various cosmetic improvements

**Tests:**
- `cmd/sdp/commands/completion_test.go`

---

### ‚úÖ Testing

**Unit Tests:**
```bash
# Completion generation
TestBashCompletion()
TestZshCompletion()
TestFishCompletion()

# Color output
TestSuccessColor()
TestErrorColor()
TestWarningColor()

# Progress bars
TestProgressBarStart()
TestProgressBarIncrement()
TestProgressBarStop()
```

**Integration Tests:**
```bash
# Build all platforms
make build-all
‚úÖ sdp-linux-amd64 (15MB)
‚úÖ sdp-darwin-amd64 (14MB)
‚úÖ sdp-darwin-arm64 (13MB)
‚úÖ sdp-windows-amd64.exe (16MB)

# Test shell completion
sdp completion bash > /tmp/sdp-completion.bash
source /tmp/sdp-completion.bash
sdp bu<TAB>  # Autocomplete to "sdp build"
```

---

### üîç Verification

**Pre-build:**
- [ ] Review Makefile build targets
- [ ] Verify lipgloss color codes
- [ ] Check bubbletea progress bar logic
- [ ] Test completion scripts

**Post-build:**
```bash
# Run tests
go test ./cmd/sdp/... -v -cover

# Build all platforms
make build-all

# Verify binary sizes
ls -lh build/

# Test completion
sdp completion bash
sdp completion zsh
sdp completion fish

# Test color output
sdp --help  # Should display colors

# Test progress bar
sdp build 00-050-12  # Should show progress
```

---

### üìù Notes

**Dependencies:** All previous workstreams

**Context:**
CLI polish (300 LOC). Production-ready binary deployment with cross-platform support.

**Key Decisions:**
- lipgloss for color output (standard Go library)
- bubbletea for progress bars (TUI framework)
- Cobra built-in completion generation
- Makefile for cross-platform builds
- Stripped binaries: `-ldflags "-s -w"`

**Risks:**
- Binary size exceeds 20MB
- Completion scripts fail
- Color output not supported on some terminals
- Progress bar performance issues

**Mitigations:**
- Optimize dependencies, use UPX compression
- Test completion scripts on all shells
- Detect terminal capabilities, disable color if needed
- Use efficient progress updates (throttling)

**Makefile Targets:**
```makefile
build-all:
	@echo "Building for all platforms..."
	@mkdir -p build
	GOOS=linux GOARCH=amd64 go build -ldflags "-s -w" -o build/sdp-linux-amd64 ./cmd/sdp
	GOOS=darwin GOARCH=amd64 go build -ldflags "-s -w" -o build/sdp-darwin-amd64 ./cmd/sdp
	GOOS=darwin GOARCH=arm64 go build -ldflags "-s -w" -o build/sdp-darwin-arm64 ./cmd/sdp
	GOOS=windows GOARCH=amd64 go build -ldflags "-s -w" -o build/sdp-windows-amd64.exe ./cmd/sdp

install:
	cp build/sdp-$(GOOS)-$(GOARCH) /usr/local/bin/sdp

completion:
	@echo "Generating completion scripts..."
	sdp completion bash > build/completion.bash
	sdp completion zsh > build/completion.zsh
	sdp completion fish > build/completion.fish
```

**Shell Integration:**
```bash
# Bash
source <(sdp completion bash)
echo "source <(sdp completion bash)" >> ~/.bashrc

# Zsh
source <(sdp completion zsh)
echo "source <(sdp completion zsh)" >> ~/.zshrc

# Fish
sdp completion fish > ~/.config/fish/completions/sdp.fish
```

**Color Output Examples:**
```go
c := NewColorizer()
fmt.Println(c.Success("‚úÖ Success message"))
fmt.Println(c.Error("‚ùå Error message"))
fmt.Println(c.Warning("‚ö†Ô∏è Warning message"))
```

**Progress Bar Usage:**
```go
p := NewProgressBar("Building workstreams")
p.Start()
for _, ws := range workstreams {
    // Execute workstream
    p.Increment()
}
p.Stop()
```

**Binary Size Optimization:**
1. Use `-ldflags "-s -w"` to strip debug info
2. Minimize dependencies
3. Use UPX compression (optional): `upx --best --lzma sdp`
4. Target sizes: Linux (15MB), macOS (14MB), Windows (16MB)

**Cross-Platform Testing:**
- Test on Linux (Ubuntu, Debian)
- Test on macOS (Intel, Apple Silicon)
- Test on Windows (10, 11)
- Verify all commands work on each platform

**Terminal Compatibility:**
- Detect NO_COLOR environment variable
- Disable color if output is not a TTY
- Fallback to plain text if lipgloss fails

**Performance:**
- Binary startup time: <100ms
- Memory footprint: <50MB
- Progress bar updates: 60 FPS (throttled)

**User Experience:**
- Intuitive help text (`sdp --help`)
- Clear error messages
- Consistent color scheme (success=green, error=red, warning=yellow)
- Smooth progress animations
