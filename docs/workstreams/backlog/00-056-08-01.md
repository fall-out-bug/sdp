---
ws_id: "00-056-08"
feature_id: "F056"
title: "Refactor parse.go to â‰¤200 LOC"
status: "backlog"
priority: "P3"
depends_on: []
blocks: []
project_id: "00"
---

# 00-056-08: Refactor parse.go to â‰¤200 LOC

## Goal

### ðŸŽ¯ Goal

Reduce `sdp-plugin/cmd/sdp/parse.go` to â‰¤200 lines to satisfy the project quality gate. Move helper functions into a new file in the same package (`main`) so parse.go is â‰¤200 LOC and CLI behavior is unchanged.

## Context

Review finding sdp-h0tf: parse.go is 215 LOC. Move validateRun, findWorkstreamFile, displayWorkstream, countErrors, and path-traversal helpers to parse_helpers.go.

## Acceptance Criteria

- [x] AC1: parse.go â‰¤200 LOC (counted by `wc -l`) â€” 71 LOC
- [x] AC2: `sdp parse <ws-id>` and `sdp parse --validate <path>` work unchanged
- [x] AC3: No change to public CLI (same flags, same behavior)
- [x] AC4: Existing parse tests pass (TestParseCommand, TestParseRun)

## Scope Files

**Implementation:**
- sdp-plugin/cmd/sdp/parse.go (reduce to root command + parseRun)
- sdp-plugin/cmd/sdp/parse_helpers.go (new: validateRun, findWorkstreamFile, displayWorkstream, countErrors, containsPathTraversal, contains, findSubstring)

## Notes

- All in package `main`. parseCmd and parseRun stay in parse.go; helpers in parse_helpers.go.
- Go allows multiple .go files in one package; no API change.

---

## Execution Report

| Step | Result |
|------|--------|
| Pre-build | âœ… PASSED |
| Guard | âœ… Activated 00-056-08 |
| Refactor | parse.go â†’ 71 LOC; parse_helpers.go added (139 LOC) |
| Build/Tests | âœ… go build; TestParseCommand, TestParseRun PASS |
| Post-build | âœ… go test ./... -short |
| AC1 | parse.go 71 LOC (â‰¤200) |
| AC2 | parse and --validate verified |
| AC3 | Same flags and behavior |
| AC4 | Parse tests PASS |
