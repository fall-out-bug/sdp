---
ws_id: 00-067-02
feature_id: F067
title: "Prompt Source-of-Truth and Drift Guard"
status: backlog
priority: 0
depends_on: [00-067-01]
blocks: [00-067-03, 00-067-08]
project_id: sdp
---

## Goal

Enforce one canonical source for prompts/agents and prevent future drift through CI checks.

## Context

Current duplication (`prompts/*` and `sdp-plugin/prompts/*`) allows behavior drift between integrations and runtime environments. F067 requires deterministic agent behavior.

## Acceptance Criteria

- [ ] AC1: Define canonical prompt source path in docs (single authoritative location)
- [ ] AC2: Add CI check that fails on drift between canonical and compatibility copies
- [ ] AC3: Standardize compatibility strategy (symlink or generated mirror) and document it
- [ ] AC4: Remove or neutralize conflicting duplicated prompt files
- [ ] AC5: Validate canonical source is used by `.claude` adapters
- [ ] AC6: Add regression test/check script for future PRs
- [ ] AC7: Update contributor guidance with "edit here, not there" rule

## Scope Files

```yaml
scope_files:
  - prompts/agents/**/*.md                                 # CANONICAL
  - sdp-plugin/prompts/agents/**/*.md                      # COMPAT/DERIVED
  - .claude/agents                                         # VERIFY link target
  - .claude/skills                                         # VERIFY link target
  - .github/workflows/go-ci.yml                            # ADD drift check step
  - docs/reference/skills.md                               # UPDATE canonical source note
  - docs/reference/configuration.md                        # UPDATE canonical source note
  - CONTRIBUTING.md                                        # UPDATE editing instructions
```

## Implementation Notes

### Canonicalization Rule

Preferred rule:
- Source of truth: `prompts/*`
- Compatibility adapters must point to source, not fork it

### Drift Detection Pattern

Implement deterministic check that:
1. Enumerates overlapping prompt files
2. Compares content hashes
3. Fails CI on mismatch
4. Prints actionable remediation path

### Backward Compatibility

If immediate cleanup is risky:
- keep compatibility layer
- enforce generated sync from canonical
- ban manual edits in compatibility copies

## Definition of Done

- [ ] CI blocks prompt drift
- [ ] Canonical path is documented and discoverable
- [ ] No ambiguous "where to edit prompts" behavior remains
- [ ] All AC met
