---
ws_id: 00-050-04
parent: sdp-79u
feature: F050
status: backlog
size: MEDIUM
project_id: 00
---

## WS-00-050-04: CLI Commands (init, doctor, build)

### üéØ Goal

Implement core CLI commands for project initialization, health checks, and TDD workflow execution. Provide production-ready command-line interface.

**What must WORK after completing this WS:**
- `sdp init` creates `.claude/` directory structure
- `sdp doctor` checks Python, Beads, git availability
- `sdp build <ws-id>` executes TDD cycle + updates Beads
- All commands support `--verbose` and `--quiet` flags
- Help text displays for all commands

**Acceptance Criteria:**
- [ ] AC1: `sdp init <project>` creates skeleton directory structure
- [ ] AC2: `sdp doctor` checks all dependencies and reports status
- [ ] AC3: `sdp build <ws-id>` executes full TDD cycle
- [ ] AC4: All commands support `--verbose` flag
- [ ] AC5: All commands support `--quiet` flag
- [ ] AC6: Help text displays with `--help` flag
- [ ] Coverage ‚â• 80%

**‚ö†Ô∏è WS is NOT complete until Goal is achieved (all AC ‚úÖ).**

---

### üìã Contracts

**Technical Constraints:**
- Must use Cobra CLI framework
- Must integrate TDD runner (00-050-02)
- Must integrate Beads wrapper (00-050-03)
- Must support global flags (verbose, quiet)

---

### üîå Interfaces

```go
package commands

// Init command
func NewInitCmd() *cobra.Command

// Doctor command
func NewDoctorCmd() *cobra.Command

// Build command
func NewBuildCmd() *cobra.Command

type DoctorResult struct {
    Check    string
    Status   bool
    Version  string
    Message  string
}
```

---

### üìÅ Scope Files

**Implementation:**
- `cmd/sdp/commands/init.go` (enhance existing)
- `cmd/sdp/commands/doctor.go` (enhance existing)
- `cmd/sdp/commands/build.go`
- `cmd/sdp/root.go` (global flags)

**Tests:**
- `cmd/sdp/commands/init_test.go`
- `cmd/sdp/commands/doctor_test.go`
- `cmd/sdp/commands/build_test.go`

---

### ‚úÖ Testing

**Unit Tests:**
```bash
# Init command
TestInitCreatesDirectoryStructure()
TestInitExistingDirectory()

# Doctor command
TestDoctorAllChecksPass()
TestDoctorMissingPython()
TestDoctorMissingBeads()

# Build command
TestBuildExecuteTDDCycle()
TestBuildWorkstreamNotFound()
TestBuildInvalidWorkstreamID()
```

**Integration Tests:**
```bash
# Full workflow test
sdp init test-project
cd test-project
sdp doctor
sdp build 00-001-01
```

---

### üîç Verification

**Pre-build:**
- [ ] Review Cobra CLI integration
- [ ] Verify directory structure creation
- [ ] Check TDD runner integration
- [ ] Check Beads wrapper integration

**Post-build:**
```bash
# Build binary
go build -o sdp ./cmd/sdp

# Test init
./sdp init test-project
ls -la test-project/.claude/

# Test doctor
./sdp doctor

# Test build
./sdp build 00-050-04 --verbose
./sdp build 00-050-04 --quiet

# Test help
./sdp --help
./sdp init --help
```

---

### üìù Notes

**Dependencies:** 00-050-01, 00-050-02, 00-050-03

**Context:**
Core CLI commands (500 LOC). Reuses existing Go code from sdp-plugin/cmd/sdp/. Integrates TDD runner and Beads wrapper.

**Key Decisions:**
- Cobra CLI framework (standard for Go CLIs)
- Global flags (verbose, quiet) for consistent UX
- Doctor checks all dependencies (Python, Beads, git)
- Build command executes TDD + updates Beads

**Risks:**
- Directory creation permissions
- Doctor checks incomplete
- TDD integration fragile

**Mitigations:**
- Check directory permissions before creation
- Comprehensive doctor checks
- Extensive integration testing
