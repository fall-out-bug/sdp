---
ws_id: "00-056-06"
feature_id: "F056"
title: "Refactor emitter_test.go to â‰¤200 LOC"
status: "completed"
priority: "P3"
depends_on: []
blocks: []
project_id: "00"
---

# 00-056-06: Refactor emitter_test.go to â‰¤200 LOC

## Goal

### ðŸŽ¯ Goal

Reduce `sdp-plugin/internal/evidence/emitter_test.go` to â‰¤200 lines to satisfy the project quality gate. Move tests into additional `*_test.go` files in the same package so each file is â‰¤200 LOC and all tests remain.

## Context

Review finding sdp-hh8w: emitter_test.go is 227 LOC. Split tests by concern (emit/core, plan, events, decision/lesson) into multiple _test.go files.

## Acceptance Criteria

- [x] AC1: emitter_test.go â‰¤200 LOC (counted by `wc -l`) â€” 86 LOC
- [x] AC2: All tests pass (`go test ./internal/evidence/...`)
- [x] AC3: No test behavior change (same test names and assertions)
- [x] AC4: Coverage of evidence package â‰¥80% â€” 86.3%

## Scope Files

**Implementation:**
- sdp-plugin/internal/evidence/emitter_test.go (reduce to â‰¤200 LOC)
- sdp-plugin/internal/evidence/plan_test.go (new â€” plan event tests)
- sdp-plugin/internal/evidence/events_test.go (new â€” generation, verification, approval, skill tests)
- sdp-plugin/internal/evidence/decision_lesson_test.go (new â€” decision, lesson tests)

**Tests:**
- All of the above (same package `evidence`)

## Notes

- Pure refactor: same tests, split across files. Helper (e.g. waitForFile) stays in emitter_test.go.
- Go allows multiple _test.go files in one package; test order is undefined.

---

## Execution Report

| Step | Result |
|------|--------|
| Pre-build | âœ… PASSED |
| Guard | âœ… Activated 00-056-06 |
| Refactor | emitter_test.go â†’ 86 LOC; plan_test.go, events_test.go, decision_lesson_test.go added |
| Tests | âœ… All pass (evidence 86.3% coverage) |
| Post-build | âœ… go build ./...; go test ./... -short |
| AC1 | emitter_test.go 86 LOC (â‰¤200) |
| AC2 | go test ./internal/evidence/ â€” PASS |
| AC3 | Same test names and assertions, split across 4 files |
| AC4 | 86.3% â‰¥ 80% |
