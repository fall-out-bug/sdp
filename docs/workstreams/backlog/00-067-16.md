---
ws_id: 00-067-16
feature_id: F067
title: "Test Bloat Audit & Refactoring"
status: pending
priority: 2
size: MEDIUM
depends_on: []
blocks: []
project_id: sdp
---

## Goal

Reduce test code bloat while maintaining 80%+ coverage. Current ratio is 1.85:1 (40K test LOC vs 22K prod LOC).

## Context

F067 achieved 85.7% average coverage, but at the cost of excessive test code:
- watcher: 5.8x ratio (470 prod / 2743 test)
- security: 4.7x ratio (286 prod / 1355 test)
- checkpoint: 4.3x ratio (190 prod / 815 test)
- git: 4.0x ratio (320 prod / 1274 test)
- decision: 3.8x ratio (404 prod / 1555 test)

Many table-driven tests have 20+ cases where 5-7 would provide equivalent coverage.

## Strategy

1. Identify tests with high duplication
2. Consolidate table-driven test cases
3. Remove redundant edge case tests
4. Target ratio: < 2.5x per package

## Scope

High-ratio packages to refactor:
- [ ] internal/watcher (5.8x → target 2.5x)
- [ ] internal/security (4.7x → target 2.5x)
- [ ] internal/checkpoint (4.3x → target 2.5x)
- [ ] internal/git (4.0x → target 2.5x)
- [ ] internal/decision (3.8x → target 2.5x)

## Acceptance Criteria

- [ ] AC1: Total test LOC reduced by 30%+ (40K → 28K)
- [ ] AC2: No package exceeds 3.0x test:code ratio
- [ ] AC3: Coverage remains >= 80% average
- [ ] AC4: All tests still pass
