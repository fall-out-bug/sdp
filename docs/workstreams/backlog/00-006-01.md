---
ws_id: 00-006-01
feature_id: F006
status: backlog
priority: P1
size: M
depends_on: ["00-004-01"]
---

# 00-006-01: NATS JetStream EVIDENCE Stream + Subject Design

Feature: F006 (sdp_dev-dcq)

## Goal

Create the NATS JetStream stream for evidence fragments. Define subject naming, retention policy, and consumer configuration.

## Scope Files

- `internal/bus/evidence_stream.go` — new: stream creation + config
- `internal/bus/evidence_stream_test.go` — new
- `deploy/k8s/nats/` — JetStream stream provisioning

## Acceptance Criteria

- [ ] JetStream stream `EVIDENCE` created with subjects `sdp.evidence.>`
- [ ] Retention: WorkQueuePolicy or LimitsPolicy with 7-day retention
- [ ] MaxMsgSize sufficient for evidence fragments (~100KB)
- [ ] `bus.CreateEvidenceStream(js nats.JetStreamContext)` idempotent setup function
- [ ] Test: publish to `sdp.evidence.test-issue.plan`, verify message arrives
- [ ] K8s manifest for stream provisioning (NATS Helm values or init container)

## Out of Scope

- Fragment publisher library (00-006-02)
- Assembler (00-007-*)

## Implementation Notes

- Use `nats.StreamConfig{Name: "EVIDENCE", Subjects: []string{"sdp.evidence.>"}, ...}`
- Consider using `InterestPolicy` so messages are only retained while there's a consumer
- Subject format: `sdp.evidence.<issueID>.<section>` where section is one of the 9 envelope sections
