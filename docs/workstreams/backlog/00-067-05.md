---
ws_id: 00-067-05
feature_id: F067
title: "Quality Gate Enforcement Alignment"
status: backlog
priority: 0
size: MEDIUM
depends_on: [00-067-04]
blocks: [00-067-06, 00-067-08, 00-067-12]
project_id: sdp
---

## Goal

Ensure CI gate behavior matches documented quality policy — coverage, guard checks, and blocking behavior are consistent across docs, config files, and workflow execution.

## Context

Three critical mismatches exist:

1. **Coverage threshold**: Docs and `.sdp/config.yml` say 80%, but CI (`go-ci.yml`) enforces 60%
2. **Quality config duplication**: Rules spread across `.sdp/guard-rules.yml` (YAML), `quality-gate.toml` (TOML), and `ci-gates.toml` (TOML) — not synchronized
3. **Guard check leniency**: CI runs `sdp guard check --staged || true`, making guard violations non-blocking

## Acceptance Criteria

- [ ] AC1: CI coverage threshold matches documented 80% or docs updated to match actual
- [ ] AC2: Guard checks in CI are blocking (remove `|| true`) or severity is explicitly documented
- [ ] AC3: Consolidate quality thresholds into single canonical config (`.sdp/guard-rules.yml`)
- [ ] AC4: Remove or deprecate redundant `quality-gate.toml` and `ci-gates.toml`
- [ ] AC5: Add CI step that validates config consistency (no threshold contradictions)
- [ ] AC6: Document per-gate blocking contract (command, threshold, blocks: yes/no)
- [ ] AC7: Python-specific quality gate references (pytest, mypy, ruff) removed or clearly marked as language-specific examples

## Scope Files

```yaml
scope_files:
  - .sdp/config.yml
  - .sdp/guard-rules.yml
  - quality-gate.toml
  - ci-gates.toml
  - .github/workflows/go-ci.yml
  - docs/reference/quality-gates.md
  - docs/reference/configuration.md
  - docs/reference/build-spec.md
  - docs/reference/review-spec.md
```

## Implementation Notes

### Blocking Contract

Document per gate:

| Gate | Command | Threshold | Blocks CI | Local Behavior |
|------|---------|-----------|-----------|----------------|
| Coverage | `go test -cover` | 80% | YES | warn |
| Guard | `sdp guard check` | per-rule severity | YES for errors | YES for errors |
| Vet | `go vet` | zero errors | YES | YES |
| Lint | `golangci-lint` | zero errors | YES | warn |

### Required Cleanup

- Remove `|| true` from blocking CI checks
- Align threshold in `go-ci.yml` coverage step: `60.0` → `80.0`
- Mark `quality-gate.toml` as deprecated or remove entirely
- Ensure `.sdp/guard-rules.yml` remains canonical source

## Definition of Done

- [ ] CI gate behavior matches documented policy
- [ ] Blocking checks fail builds deterministically
- [ ] No threshold mismatch between docs/config/workflows
- [ ] AC1-AC7 met
