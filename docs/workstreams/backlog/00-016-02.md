---
ws_id: 00-016-02
feature_id: F016
status: done
priority: P1
size: M
depends_on: ["00-016-01"]
---

# 00-016-02: Oneshot Outer Loop — Cursor Integration

Feature: F016 (sdp_dev-dhip)

## Goal

Wire the outer loop state machine into Cursor's agent model. The oneshot skill becomes a thin wrapper that calls `sdp orchestrate` and handles LLM invocations inline.

## Scope Files

- `.cursor/commands/oneshot.md` — updated command
- `.claude/skills/oneshot/SKILL.md` — slim version (3 rules, positive framing)
- `sdp/prompts/skills/oneshot/SKILL.md` — canonical source

## Acceptance Criteria

- [x] `/oneshot F004` in Cursor calls `sdp orchestrate F004` as the outer loop
- [x] When outer loop requests "@build 00-004-01", agent executes inline
- [x] When outer loop requests "@review F004", agent executes inline
- [x] PR creation and CI loop handled entirely by CLI — no agent involvement
- [x] Oneshot skill reduced from 8 CRITICAL RULES to 3, positive framing
- [x] No "Next steps" or handoff lists in output
- [x] Test: complete F001-level feature in Cursor without premature exit (3/3 runs)

## Out of Scope

- Claude Code integration (00-016-03)
- Auto-fix engine improvements (future)

## Implementation Notes

### How Cursor Invokes the Outer Loop

Option A — **Script-first:** Agent runs `sdp orchestrate F004` which outputs instructions like `INVOKE: @build 00-004-01`. Agent reads stdout, executes, writes result to a file, outer loop reads it and advances.

Option B — **Skill-first:** Slim oneshot skill reads checkpoint, follows the phase that `sdp orchestrate` set. After each phase, runs `sdp orchestrate F004 --advance` to transition.

Option B is simpler for Cursor because the agent IS the execution environment.

### Slim Prompt (3 Rules)

```
1. Read checkpoint: `cat .sdp/checkpoints/F004.json`
2. Execute the current phase (build/review). Output only code and commit messages.
3. After each phase: `sdp orchestrate F004 --advance`. If CI phase: `sdp ci-loop --pr N --feature F004`.
```
