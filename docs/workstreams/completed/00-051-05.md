---
ws_id: 00-051-05
feature_id: F051
title: "Agent Coordination: Dynamic Role Switching"
status: completed
priority: 0
depends_on: [00-051-04]
blocks: []
project_id: sdp
beads_id: sdp-6fx.6
---

## Goal

Implement dynamic role switching for agents based on task type and context.

## Context

Part of F051 Long-term Memory System. Allows orchestrator to switch agent roles based on task requirements.

**Related Beads:** sdp-6fx.6 (Dynamic agent role switching)

## Acceptance Criteria

- [ ] AC1: Define role types (implementer, reviewer, coordinator, specialist)
- [ ] AC2: Role assignment based on task metadata
- [ ] AC3: Role transition events in coordination log
- [ ] AC4: Prompt/context injection based on current role
- [ ] AC5: Support multi-role agents (one agent, multiple capabilities)

## Scope Files

```yaml
scope_files:
  - sdp-plugin/internal/coordination/roles.go        # NEW
  - sdp-plugin/internal/coordination/roles_test.go   # NEW
  - sdp-plugin/internal/coordination/switcher.go     # NEW
  - sdp-plugin/internal/coordination/switcher_test.go # NEW
  - sdp-plugin/internal/orchestrator/dispatcher.go   # MODIFY
```

## Implementation Notes

### Role Definition

```go
type Role string

const (
    RoleImplementer Role = "implementer"
    RoleReviewer    Role = "reviewer"
    RoleCoordinator Role = "coordinator"
    RoleSpecialist  Role = "specialist"
)

type RoleCapabilities struct {
    Role        Role
    CanExecute  bool
    CanReview   bool
    CanDispatch bool
    Specialties []string // "security", "performance", "testing"
}
```

### Role Assignment Logic

```go
func AssignRole(task *Task, history []AgentEvent) Role {
    // Check task type
    if task.Type == "review" {
        return RoleReviewer
    }

    // Check if implementing own code
    if wasImplementedBy(history, task.ID, task.AssignedAgent) {
        return RoleReviewer // Switch to reviewer for own work
    }

    return RoleImplementer
}
```

### Role Transition Events

When role changes, emit event:
```json
{"type": "role_switch", "from": "implementer", "to": "reviewer", "reason": "self-review"}
```

## Definition of Done

- [ ] All AC met
- [ ] Tests pass with â‰¥80% coverage
- [ ] Role transitions logged correctly
- [ ] Orchestrator uses role-based dispatch
