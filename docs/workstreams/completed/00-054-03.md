---
ws_id: "00-054-03"
feature_id: "F054"
title: "Evidence Schema v0.1"
status: "completed"
priority: "P0"
depends_on: ["00-054-01"]
blocks: ["00-054-04"]
project_id: "00"
---

# 00-054-03: Evidence Schema v0.1

## Goal

Define the JSON Schema for evidence log events. Six event types: plan, generation, verification, approval, **decision**, **lesson**.

## Context

From VISION.md: "Schema v0.1 (four event types: plan, generation, verification, approval). Provenance = generation event type."

Extended with memory/knowledge types: `decision` (we decided X because Y) and `lesson` (auto-extracted from outcomes). Memory IS the evidence log — no separate system.

This is the data contract for the entire evidence + knowledge layer.

## Acceptance Criteria

- [ ] AC1: `schema/evidence.schema.json` defines base Event structure
- [ ] AC2: Six event types defined: `plan`, `generation`, `verification`, `approval`, `decision`, `lesson`
- [ ] AC3: `generation` event includes provenance fields (model_id, model_version, prompt_hash)
- [ ] AC4: `verification` event includes pass/fail, gate_name, coverage
- [ ] AC5: All events share: id, type, timestamp, ws_id, commit_sha
- [ ] AC6: Hash chain field: `prev_hash` (SHA-256 of previous event)
- [ ] AC7: Schema registered in `schema/index.json`
- [ ] AC8: Go types generated/written matching the schema
- [ ] AC9: `decision` event includes: question, choice, rationale, alternatives, confidence, reverses (optional ID of reversed decision)
- [ ] AC10: `lesson` event includes: category, insight, source_ws_id, outcome (worked/failed/mixed), related_decisions

## Scope Files

**Implementation:**
- schema/evidence.schema.json (new)
- schema/index.json (update)
- sdp-plugin/internal/evidence/types.go (new)
- sdp-plugin/internal/evidence/types_test.go (new)

**Tests:**
- sdp-plugin/internal/evidence/types_test.go

## Event Structures

```json
// generation event (provenance)
{
  "id": "evt-uuid", "type": "generation",
  "timestamp": "2026-02-08T12:00:00Z", "ws_id": "00-054-03",
  "commit_sha": "abc123", "prev_hash": "sha256-of-previous-event",
  "data": {
    "model_id": "claude-sonnet-4-20250514",
    "model_version": "20250514",
    "prompt_hash": "sha256-of-prompt",
    "files_changed": ["internal/evidence/types.go"]
  }
}

// decision event (knowledge)
{
  "id": "evt-uuid", "type": "decision",
  "timestamp": "2026-02-08T12:05:00Z", "ws_id": "00-054-03",
  "commit_sha": "abc123", "prev_hash": "sha256-of-previous-event",
  "data": {
    "question": "How to store evidence events?",
    "choice": "Append-only JSONL with hash chain",
    "rationale": "Proven pattern from telemetry collector, no DB dependency",
    "alternatives": ["SQLite", "Protobuf log", "Git notes"],
    "confidence": 0.85,
    "reverses": null,
    "tags": ["architecture", "storage"]
  }
}

// lesson event (knowledge)
{
  "id": "evt-uuid", "type": "lesson",
  "timestamp": "2026-02-08T18:00:00Z", "ws_id": "00-054-03",
  "commit_sha": "def456", "prev_hash": "sha256-of-previous-event",
  "data": {
    "category": "architecture",
    "insight": "Append-only JSONL scales to 100K events without issues",
    "outcome": "worked",
    "source_ws_id": "00-054-04",
    "related_decisions": ["evt-decision-uuid"]
  }
}
```

## Verification

```bash
# Schema validates
cd sdp-plugin && go test ./internal/evidence/... -v -cover
# Schema file exists and is valid JSON
python3 -c "import json; json.load(open('schema/evidence.schema.json'))"
```

## Notes

- ~2h work (expanded scope: 6 event types instead of 4)
- Keep schema minimal — we can add fields later
- Provenance is a `generation` event field, NOT a separate subsystem
- Memory is the evidence log — `decision` and `lesson` are event types, NOT a separate system
- Hash chain = corruption detection, not tamper-proof (per expert feedback)
- Decisions are the "why" layer; lessons are the "what we learned" layer
