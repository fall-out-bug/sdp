---
ws_id: "00-054-06"
feature_id: "F054"
title: "Acceptance Test Gate"
status: "completed"
priority: "P0"
depends_on: ["00-054-02"]
blocks: ["00-054-09"]
project_id: "00"
---

# 00-054-06: Acceptance Test Gate

## Goal

After every `@build`, run a smoke test to verify the app actually works. Not just unit tests — functional verification.

## Context

The ad server case: 7K LOC, 88% coverage, all quality gates green — basic features broken. The acceptance test gate is the fix. 5 lines of config, 30 seconds of runtime, catches the failures that unit tests miss.

## Acceptance Criteria

- [ ] AC1: Reads acceptance test config from `.sdp/config.yml`
- [ ] AC2: `sdp acceptance run` executes the configured command
- [ ] AC3: Configurable timeout (default: 30s)
- [ ] AC4: Exit code 0 = pass, non-zero = fail
- [ ] AC5: Optional expected output match (substring or regex)
- [ ] AC6: Graceful fallback: if no config, skip with warning (not error)
- [ ] AC7: `sdp verify` calls acceptance test after quality gates
- [ ] AC8: Human-readable output: "Acceptance: PASS (2.3s)" or "Acceptance: FAIL — timeout after 30s"

## Scope Files

**Implementation:**
- sdp-plugin/cmd/sdp/acceptance.go (new)
- sdp-plugin/internal/acceptance/runner.go (new)
- sdp-plugin/internal/acceptance/runner_test.go (new)
- sdp-plugin/cmd/sdp/verify.go (update — integrate acceptance gate)

**Tests:**
- sdp-plugin/internal/acceptance/runner_test.go

## Config

```yaml
# .sdp/config.yml
acceptance:
  command: "go test ./... -run TestSmoke -count=1"
  timeout: 30s
  expected: "PASS"
```

## Runner Design

```go
type Runner struct {
    Command  string
    Timeout  time.Duration
    Expected string  // substring match
}

type Result struct {
    Passed   bool
    Duration time.Duration
    Output   string
    Error    string
}

func (r *Runner) Run(ctx context.Context) (*Result, error)
```

## Verification

```bash
cd sdp-plugin && go test ./internal/acceptance/... -v -cover -race
# Manual: create config, run sdp acceptance run, verify output
```

## Notes

- ~1.5h work
- This is the single most impactful workstream in F054
- Keep it dead simple: run command, check exit code, optional output match
- Do NOT add Docker, browser testing, or complex orchestration — that's future work
