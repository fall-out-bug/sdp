---
ws_id: "00-054-11"
feature_id: "F054"
title: "Lessons Learned & 'We Already Tried' Warnings"
status: "completed"
priority: "P0"
depends_on: ["00-054-10"]
blocks: []
project_id: "00"
---

# 00-054-11: Lessons Learned & "We Already Tried" Warnings

## Goal

Two capabilities:
1. Auto-extract lessons from completed workstreams (what worked, what failed)
2. Proactive warnings when approaching a decision similar to a past failure

## Context

The killer memory feature: "You tried MongoDB in WS-003, it failed because of scaling issues. Continue anyway?"

Old F051 estimated 7-10 days for "We Already Tried" detection alone (with embeddings, TF-IDF, etc.). New approach: decisions are in the evidence log, search is already built. Just add a similarity check on decision capture + lesson extraction on WS completion.

## Acceptance Criteria

- [ ] AC1: When a workstream completes, `sdp verify` emits `lesson` event (auto-extracted)
- [ ] AC2: Lesson includes: what worked, what failed, category, related decisions
- [ ] AC3: `sdp guard activate` checks evidence for similar past decisions
- [ ] AC4: If similar FAILED decision found → warning with context (not blocking)
- [ ] AC5: `sdp log show --type=lesson` lists all lessons
- [ ] AC6: `sdp log show --type=lesson --outcome=failed` shows only failures
- [ ] AC7: Similarity: keyword-based matching on decision question + tags (no embeddings — simple first)
- [ ] AC8: Warning format: "Similar decision found: {question} → {outcome}. Source: {ws_id}. Continue? (y/n)"

## Scope Files

**Implementation:**
- sdp-plugin/internal/evidence/lessons.go (new — lesson extraction)
- sdp-plugin/internal/evidence/warnings.go (new — similarity check)
- sdp-plugin/internal/evidence/lessons_test.go (new)
- sdp-plugin/internal/evidence/warnings_test.go (new)
- sdp-plugin/cmd/sdp/verify.go (update — emit lesson on WS completion)
- sdp-plugin/cmd/sdp/guard.go (update — check for similar failures on activate)

**Tests:**
- sdp-plugin/internal/evidence/lessons_test.go
- sdp-plugin/internal/evidence/warnings_test.go

## Similarity Algorithm (Simple)

```go
func FindSimilarDecisions(query string, tags []string) []Match {
    // 1. Search decisions with matching tags
    // 2. Full-text search on question field
    // 3. Filter to failed/mixed outcomes
    // 4. Return sorted by relevance (tag overlap + keyword match)
    // No embeddings, no ML — just structured search
}
```

## Warning Output

```
$ sdp guard activate 00-060-03

⚠️  Similar past decision found:
   Decision: "Use MongoDB for user data"
   Outcome: FAILED — scaling issues at 10M rows
   Source: WS 00-042-02 (3 months ago)
   Tags: database, architecture

   Continue anyway? [y/N]
```

## Notes

- ~2h work
- Lesson extraction: parse verification events for pass/fail patterns
- Similarity: tag overlap + keyword match. No ML. Upgrade to embeddings later if needed.
- This replaces F051 Phase 3 (similarity + "we tried" + recommendations) in 1 WS instead of 3
- Non-blocking: warnings are advisory, never prevent activation
