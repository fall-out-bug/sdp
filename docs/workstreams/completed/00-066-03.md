---
ws_id: 00-066-03
feature_id: F066
title: "Prompts: Graceful Degradation Logic"
status: backlog
priority: 0
depends_on: [00-066-01]
blocks: [00-066-04]
project_id: sdp
---

## Goal

Update prompts to detect CLI availability and gracefully degrade to shell fallbacks.

## Context

Part of F066 Protocol/Prompts Separation. Prompts should work whether CLI is available or not.

## Acceptance Criteria

- [ ] AC1: @build skill works without CLI (uses shell fallbacks)
- [ ] AC2: @review skill works without CLI (reduced validation)
- [ ] AC3: @oneshot skill works without CLI (uses shell fallbacks)
- [ ] AC4: Clear error when REQUIRED CLI feature is unavailable
- [ ] AC5: Document dependency level in each skill's SKILL.md

## Scope Files

```yaml
scope_files:
  - prompts/skills/build/SKILL.md     # MODIFY
  - prompts/skills/review/SKILL.md    # MODIFY
  - prompts/skills/oneshot/SKILL.md   # MODIFY
  - prompts/skills/guard/SKILL.md     # MODIFY
```

## Implementation Notes

### Detection Pattern

Add to each skill that uses CLI:

```markdown
## CLI Dependencies

| Command | Level | Fallback |
|---------|-------|----------|
| sdp guard check | OPTIONAL | scripts/sdp-guard-check.sh |
| sdp drift detect | OPTIONAL | scripts/sdp-drift-detect.sh |

**Detection:**
```bash
if command -v sdp > /dev/null 2>&1; then
    # Use CLI (enhanced)
    sdp guard context check
else
    # Use fallback (basic)
    ./scripts/sdp-guard-check.sh
fi
```
```

### @build Skill Update

Current:
```bash
sdp guard activate {WS-ID}
```

Updated:
```bash
# CLI Detection
if command -v sdp > /dev/null 2>&1; then
    sdp guard activate {WS-ID}  # Full session validation
else
    ./scripts/sdp-guard-check.sh {WS-ID}  # Basic branch check
fi
```

### @review Skill Update

Current:
```bash
sdp contract validate
```

Updated:
```bash
# Contract validation requires CLI
if command -v sdp > /dev/null 2>&1; then
    sdp contract validate  # Full contract validation
else
    echo "NOTE: Contract validation skipped (CLI unavailable)"
    echo "Run 'sdp contract validate' manually after installing CLI"
fi
```

### Dependency Level Badges

Add to each SKILL.md header:

```markdown
**CLI Dependency:** OPTIONAL (shell fallback available)
```

Or:

```markdown
**CLI Dependency:** REQUIRED (no fallback)
```

## Definition of Done

- [ ] All AC met
- [ ] Skills tested without CLI
- [ ] Clear user feedback when falling back
