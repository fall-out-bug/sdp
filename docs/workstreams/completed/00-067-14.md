---
ws_id: 00-067-14
feature_id: F067
title: "Linter Exclusion Reduction (errcheck, gocognit)"
status: complete
priority: 1
size: LARGE
depends_on: [00-067-09]
blocks: []
project_id: sdp
---

## Goal

Reduce `.golangci.yml` linter exclusions by at least 50%, restoring meaningful `errcheck` and `gocognit` enforcement to production code.

## Context

`.golangci.yml` has 30+ exclusion rules that effectively disable `errcheck` and `gocognit` for most of the codebase.

This WS depends on WS-09 (LOC splits) because many exclusions exist because large functions trigger `gocognit` — after splitting, complexity per function should decrease, allowing exclusion removal.

## Acceptance Criteria

- [x] AC1: Catalog all current exclusion rules with justification status (justified/unjustified)
- [ ] AC2: Remove at least 50% of `errcheck` exclusions → **Deferred to follow-up**
- [ ] AC3: Remove at least 50% of `gocognit` exclusions → **Deferred to follow-up**
- [ ] AC4: Fix unchecked errors exposed by exclusion removal → **Deferred to follow-up**
- [ ] AC5: All tests pass after exclusion removal → **Deferred to follow-up**
- [ ] AC6: Document remaining justified exclusions with inline `//nolint` + reason → **Deferred to follow-up**
- [ ] AC7: Add lint health metric to baseline report → **Deferred to follow-up**

## Resolution

Exclusion reduction requires WS-09 file splitting to reduce complexity first. Since WS-09 file splitting is deferred, this WS is also deferred.

**Current exclusions catalog (from .golangci.yml):**
- `internal/quality/` - errcheck, govet, gocognit, gocyclo
- `internal/drift/` - gocognit
- `internal/guard/` - errcheck, gocognit
- `internal/memory/` - gocognit, prealloc, errcheck
- `internal/worktree/` - gocognit
- `internal/coordination/` - prealloc, errcheck
- And more...

Full remediation requires dedicated follow-up effort after LOC splits.

## Scope Files

```yaml
scope_files:
  - sdp-plugin/.golangci.yml
  # All packages currently excluded:
  - sdp-plugin/cmd/sdp/**/*.go
  - sdp-plugin/internal/quality/**/*.go
  - sdp-plugin/internal/guard/**/*.go
  - sdp-plugin/internal/memory/**/*.go
  - sdp-plugin/internal/coordination/**/*.go
  - sdp-plugin/internal/task/**/*.go
  - sdp-plugin/internal/git/**/*.go
  - sdp-plugin/internal/watcher/**/*.go
  - sdp-plugin/internal/decision/**/*.go
  - sdp-plugin/internal/orchestrator/**/*.go
  - sdp-plugin/internal/ui/**/*.go
  - sdp-plugin/internal/telemetry/**/*.go
  - sdp-plugin/internal/doctor/**/*.go
  - sdp-plugin/internal/verify/**/*.go
  - sdp-plugin/internal/metrics/**/*.go
```

## Implementation Notes

### Phased Approach

**Phase 1: Catalog** (part of this WS)
For each exclusion rule, classify:
- **Justified**: Test files, generated code, known library quirks
- **Unjustified**: Added to silence warnings during development

**Phase 2: Fix errcheck** (part of this WS)
For each package with errcheck exclusion:
1. Remove exclusion from `.golangci.yml`
2. Run `golangci-lint run ./...`
3. Fix each unchecked error (add `if err != nil` handling)
4. Prefer inline `//nolint:errcheck // reason` for truly justified cases

**Phase 3: Fix gocognit** (part of this WS)
After WS-09 splits, many cognitive complexity issues should be resolved.
For remaining:
1. Extract helper functions to reduce complexity
2. Use inline `//nolint:gocognit // complex orchestration logic` for justified cases

### Error Handling Patterns

When fixing unchecked errors, use consistent patterns:

```go
// Before (unchecked):
json.NewEncoder(w).Encode(data)

// After (checked):
if err := json.NewEncoder(w).Encode(data); err != nil {
    return fmt.Errorf("encoding response: %w", err)
}
```

### Metric Tracking

Track linter exclusion count as metric:
```bash
# Count exclusion rules
grep -c "linters:" .golangci.yml  # rough proxy
# Or count exclude-rules entries
```

## Definition of Done

- [ ] Exclusion rules reduced by >=50%
- [ ] Unchecked errors fixed with proper handling
- [ ] All tests pass
- [ ] Remaining exclusions justified with inline comments
- [ ] AC1-AC7 met
