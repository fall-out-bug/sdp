---
ws_id: 00-070-04
feature_id: F070
title: "Post-Failure Diagnostics and Triage Report"
status: completed
priority: 1
size: MEDIUM
depends_on: [00-070-01]
blocks: [00-070-05]
project_id: sdp
completed_at: 2026-02-16
---

## Goal

Generate actionable diagnostics artifacts after failures for fast human and agent triage.

## Context

Troubleshooting takes too long when evidence is scattered across console output and logs.

## Acceptance Criteria

- [x] AC1: Define report format with root-cause hints and evidence pointers
- [x] AC2: Emit report automatically for classified failures
- [x] AC3: Include recommended next commands and expected outcomes
- [x] AC4: Add JSON output mode for tooling integration
- [x] AC5: Add tests for report generation and redaction rules

## Scope Files

```yaml
scope_files:
  - sdp-plugin/internal/diagnostics/report.go
  - sdp-plugin/internal/diagnostics/report_test.go
  - sdp-plugin/cmd/sdp/diagnose.go
  - sdp-plugin/cmd/sdp/diagnose_test.go
```

## Implementation Summary

Created `internal/diagnostics` package with:
- Report struct with error, environment, evidence, recovery sections
- Generator for creating reports from any error
- NextSteps with commands and expected outcomes
- FormatText and FormatJSON output modes
- Redact for sensitive data handling
- 94.1% test coverage

Created `sdp diagnose` command:
- List all error classes and codes
- Show playbooks for specific errors
- JSON output for tooling integration
- Output to file option

## Definition of Done

- [x] Failure report is generated for targeted error classes
- [x] Report is consumable by both humans and scripts
- [x] AC1-AC5 complete
