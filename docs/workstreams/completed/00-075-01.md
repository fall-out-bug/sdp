---
ws_id: "00-075-01"
feature_id: "F075"
title: "WS: Doctor Repair Mode"
status: completed
priority: 2
size: MEDIUM
depends_on: []
blocks: []
---

# WS: Doctor Repair Mode

**Feature**: F075 - Self-Healing Doctor
**ID**: 00-075-01
**Priority**: P0
**Depends on**: -

## Goal
Add `--repair` flag to `sdp doctor` command that automatically fixes detected issues.

## Scope Files
- `sdp-plugin/cmd/sdp/doctor.go`
- `sdp-plugin/internal/doctor/doctor.go`
- `sdp-plugin/internal/doctor/doctor_repair.go`
- `sdp-plugin/internal/doctor/doctor_repair_perms.go`

## Acceptance Criteria
- [x] AC1: `sdp doctor --repair` runs all checks and attempts auto-fix
- [x] AC2: Fixes file permissions (chmod 0600 for sensitive files)
- [x] AC3: Creates missing `.claude/` subdirectories
- [x] AC4: Reports what was fixed vs what needs manual intervention
- [x] AC5: Returns non-zero exit code if any unfixable errors remain
- [x] AC6: Tests for repair functionality (>= 80% coverage)

## Implementation Summary

Implemented `RunWithRepair()` function that:
- Auto-fixes file permissions on sensitive files (0600)
- Creates missing `.claude/skills`, `.claude/agents`, `.claude/validators` directories
- Creates missing `.sdp/log` directory
- Returns `RepairAction` structs with status (fixed/skipped/manual/failed/partial)

## Test Coverage
- Unit tests for each repair action in `doctor_repair_test.go`
- Coverage: 85.1% (exceeds 80% requirement)
