---
ws_id: "00-063-01"
feature_id: "F063"
title: "Hook Ownership and Installer Unification"
status: "complete"
priority: "P0"
depends_on: []
blocks: ["00-063-02", "00-063-03"]
project_id: "00"
---

# 00-063-01: Hook Ownership and Installer Unification

## Goal

Unify SDP hook installation so one canonical path manages hooks safely with marker-based ownership and idempotent behavior.

## Context

Today there are two hook systems (`hooks/*.sh` and `sdp hooks install` template). This creates drift and inconsistent behavior across machines.

## Source of inspiration

- [guardian-cli hook manager implementation](https://github.com/AlexGladkov/guardian-cli/blob/main/internal/git/hooks.go)
- [guardian-cli hook manager tests](https://github.com/AlexGladkov/guardian-cli/blob/main/internal/git/hooks_test.go)

## Acceptance Criteria

- [x] AC1: `sdp hooks install` installs canonical SDP hooks for `pre-commit`, `pre-push`, `post-merge`, `post-checkout`
- [x] AC2: Installed hooks include SDP marker (e.g., `# SDP-MANAGED-HOOK`)
- [x] AC3: Install is idempotent (re-run does not duplicate)
- [x] AC4: Uninstall removes only SDP-managed hooks and leaves non-SDP hooks untouched
- [x] AC5: Hook scripts are POSIX-safe (`/bin/sh` compatible redirects)
- [x] AC6: Missing `sdp` binary/path yields clear warning message in hook output

## Scope Files

**Implementation:**
- sdp-plugin/internal/hooks/hooks.go (update)
- sdp-plugin/cmd/sdp/hooks.go (update)
- hooks/install-hooks.sh (update)
- docs/runbooks/git-hooks-installation.md (update)

**Tests:**
- sdp-plugin/internal/hooks/hooks_test.go (new or update)

## Notes

- ~2h work
- Preserve backward compatibility where possible
- Favor explicit diagnostics over silent skips
