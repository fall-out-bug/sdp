---
ws_id: 00-067-10
feature_id: F067
title: "Go Module Consolidation (Dual Source Tree + go.work)"
status: complete
priority: 1
size: MEDIUM
depends_on: [00-067-04]
blocks: []
project_id: sdp
---

## Goal

Resolve the dual Go module tree confusion by introducing `go.work` and documenting the canonical module structure.

## Context

Go source code lives in two separate module trees:

| Tree | Module | Files | Purpose |
|------|--------|-------|---------|
| `sdp-plugin/` | `github.com/fall-out-bug/sdp` | 324 internal files | CLI + main logic |
| `src/sdp/` | (root `go.mod`) | ~50 files | Graph, synthesis, monitoring, agents |

These two modules don't reference each other. Tests in `tests/` cover `src/sdp/` but not `sdp-plugin/internal/`. There's no `go.work` to manage them as a workspace.

Contributors don't know where to add code. Build commands differ between trees.

## Acceptance Criteria

- [x] AC1: Create `go.work` at repo root tying both modules together → **BLOCKED** (same module name conflict)
- [x] AC2: Document which module is for what in CONTRIBUTING.md
- [x] AC3: Verify `go work sync` succeeds without errors → **FAILED** (module name conflict)
- [x] AC4: Both modules build from repo root via workspace → **NOT POSSIBLE** without go.work
- [x] AC5: Tests for both modules can be run from a single command → **NOT POSSIBLE** without go.work
- [x] AC6: Evaluate feasibility of merging `src/sdp/` into `sdp-plugin/internal/` (document decision)
- [x] AC7: CI updated to use workspace-aware build if needed → **N/A** (no workspace)

## Resolution

**go.work cannot be created** because both modules use the same module path (`github.com/fall-out-bug/sdp`).

Decision documented in [ADR-001](docs/decisions/ADR-001-dual-module-structure.md):
- Keep dual modules without workspace
- Future consolidation requires renaming sdp-plugin module path (152 import changes)
- Module structure documented in CONTRIBUTING.md

## Scope Files

```yaml
scope_files:
  - go.work                          # NEW
  - go.mod                           # root module
  - sdp-plugin/go.mod               # plugin module
  - CONTRIBUTING.md                  # document module structure
  - .github/workflows/go-ci.yml     # workspace-aware build
```

## Implementation Notes

### go.work File

```go
go 1.24

use (
    .
    ./sdp-plugin
)
```

### Module Relationship Analysis

Before creating go.work, analyze:
1. Does `sdp-plugin` import from root module? (likely no)
2. Does root module import from `sdp-plugin`? (likely no)
3. Are there shared types or interfaces? (check for duplicated types)

### Long-term Strategy

Decision to document in AC6:
- **Option A**: Keep two modules with go.work (less churn, more complexity)
- **Option B**: Merge `src/sdp/` into `sdp-plugin/internal/` (one module, clean but big diff)
- **Option C**: Deprecate root module, make `sdp-plugin/` the only module

### Unified Test Command

```bash
# From repo root with go.work:
go test ./...                    # tests both modules
go test ./sdp-plugin/...        # just plugin
go test ./src/sdp/...           # just core
```

## Definition of Done

- [x] ~~go.work exists and `go work sync` succeeds~~ **NOT POSSIBLE** - module name conflict (see ADR-001)
- [x] Module architecture documented (CONTRIBUTING.md)
- [x] Consolidation strategy documented as ADR (ADR-001)
- [x] AC1-AC7 resolved (see Resolution section)
