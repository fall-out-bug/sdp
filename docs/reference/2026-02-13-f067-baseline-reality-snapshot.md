# F067 Baseline Reality Snapshot

> **Date:** 2026-02-13
> **Feature:** F067 - Repository Hardening
> **Author:** Claude Code (Automated Audit)

---

## Executive Summary

This document captures the baseline state of the repository before F067 hardening improvements. Key metrics serve as comparison points for measuring improvement.

**Overall Health Score:** 72/100

---

## 1. Toolchain State

| Component | Version | Status |
|-----------|---------|--------|
| Go | 1.25.6 darwin/arm64 | ✅ Current |
| golangci-lint | 2.8.0 | ✅ Current |
| go.mod directive | go 1.24.2 | ⚠️ Mismatch (go.mod < actual) |

**Notes:**
- Go version mismatch: go.mod specifies 1.24.2 but runtime is 1.25.6
- Should align go.mod with actual Go version

---

## 2. Quality Metrics

### Test Coverage

| Metric | Value | Target | Status |
|--------|-------|--------|--------|
| Average Coverage | 79.13% | 80% | ⚠️ Below target |
| Packages < 80% | 6 | 0 | ❌ Needs work |

**Low Coverage Packages:**
| Package | Coverage | Gap |
|---------|----------|-----|
| cmd/sdp | 23.6% | -56.4% |
| internal/context | 16.9% | -63.1% |
| internal/git | 42.0% | -38.0% |
| internal/worktree | 38.0% | -42.0% |
| internal/quality | 69.9% | -10.1% |
| internal/ui/dashboard | 67.2% | -12.8% |

### Lint Status

| Metric | Value | Target |
|--------|-------|--------|
| golangci-lint errors | 10 errcheck warnings | 0 |
| Test file defer warnings | 10 | Acceptable |

---

## 3. Lines of Code Compliance

| Category | Count | Status |
|----------|-------|--------|
| Files > 200 LOC (total) | 51 | ❌ Violations |
| Non-test files > 200 LOC | 31 | ❌ Violations |
| Test files > 200 LOC | 20 | ⚠️ Expected |

**Top Violations (Non-test):**
| File | Lines |
|------|-------|
| cmd/sdp/contract.go | 580 |
| internal/doctor/doctor.go | 468 |
| internal/collision/collision.go | ~268 |
| internal/memory/tracker.go | ~270 |
| internal/memory/memory.go | ~253 |
| internal/decision/logger.go | ~250 |
| internal/memory/export.go | ~250 |

---

## 4. Linter Exclusions

| Metric | Count |
|--------|-------|
| Path-based exclusions | 25 |
| Per-path linter disables | ~50 |

**Excluded Paths:**
- internal/quality/ (all linters)
- internal/drift/ (gocognit)
- internal/guard/ (errcheck, gocognit)
- internal/memory/ (gocognit, prealloc, errcheck)
- internal/worktree/ (gocognit)
- internal/coordination/ (prealloc, errcheck)
- internal/task/ (errcheck)
- internal/git/ (errcheck)
- cmd/sdp/ (errcheck, gocognit)
- internal/watcher/ (errcheck, gocognit)
- internal/parser/ (gocognit)
- internal/decision/ (errcheck, unused)
- internal/orchestrator/ (errcheck)
- internal/ui/ (errcheck, unused, gocognit)
- internal/telemetry/ (gocognit)
- internal/doctor/ (gocognit)
- internal/verify/ (gocognit, gocyclo)
- internal/ui/dashboard/ (gocognit, gocyclo)
- internal/metrics/ (gocognit, gocyclo)

---

## 5. Repository Hygiene

| Metric | Status |
|--------|--------|
| Untracked files | 0 ✅ |
| Modified files | 5 (in progress) |
| Branch | dev |
| Remote sync | ✅ Up to date |

---

## 6. Security Posture

| Area | Status | Notes |
|------|--------|-------|
| Command whitelist | ✅ Implemented | validator.go |
| Argument validation | ✅ Implemented | Injection patterns blocked |
| Timeout enforcement | ✅ Implemented | Default 30s |
| Shell execution | ✅ Fixed | Acceptance runner uses direct execution |
| Path traversal protection | ✅ Implemented | SafeJoinPath, SanitizePath |
| YAML bomb protection | ✅ Implemented | SafeYAMLUnmarshal with limits |
| File permissions | ⚠️ Partial | Doctor check exists |

---

## 7. Improvement Targets

| Target | Current | Goal | Delta |
|--------|---------|------|-------|
| Coverage | 79.13% | 80%+ | +0.87% |
| LOC violations (non-test) | 31 | 0 | -31 |
| Linter exclusions | 25 paths | <10 | -15 |
| go.mod alignment | Mismatch | Aligned | Fix |

---

## 8. Risk Assessment

| Risk | Severity | Mitigation |
|------|----------|------------|
| Low coverage in cmd/sdp | HIGH | Add integration tests |
| Low coverage in internal/git | HIGH | Add wrapper tests |
| Low coverage in internal/worktree | HIGH | Add operation tests |
| Many LOC violations | MEDIUM | Refactor to smaller files |
| Linter exclusion sprawl | MEDIUM | Reduce over time |

---

*Generated by F067 Baseline Audit - 2026-02-13*
